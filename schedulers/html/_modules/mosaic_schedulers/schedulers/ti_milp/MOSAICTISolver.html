

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver &mdash; MOSAIC schedulers 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> MOSAIC schedulers
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Scheduling.html">2. Time-varying scheduling algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Allocation.html">3. Task allocation algorithm for robotic networks with periodic connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Examples.html">4. Usage Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API.html">5. API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class_documentation.html">6. Modules documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MOSAIC schedulers</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The module ``ti_milp`` provides an implementation of the task allocation</span>
<span class="sd">algorithm for for robotic networks with periodic connectivity.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> Copyright 2019 by California Institute of Technology.  ALL RIGHTS RESERVED.</span>
<span class="sd"> United  States  Government  sponsorship  acknowledged.   Any commercial use</span>
<span class="sd"> must   be  negotiated  with  the  Office  of  Technology  Transfer  at  the</span>
<span class="sd"> California Institute of Technology.</span>
<span class="sd"> </span>
<span class="sd"> This software may be subject to  U.S. export control laws  and regulations.</span>
<span class="sd"> By accepting this document,  the user agrees to comply  with all applicable</span>
<span class="sd"> U.S. export laws and regulations.  User  has the responsibility  to  obtain</span>
<span class="sd"> export  licenses,  or  other  export  authority  as may be required  before</span>
<span class="sd"> exporting  such  information  to  foreign  countries or providing access to</span>
<span class="sd"> foreign persons.</span>
<span class="sd"> </span>
<span class="sd"> This  software  is a copy  and  may not be current.  The latest  version is</span>
<span class="sd"> maintained by and may be obtained from the Mobility  and  Robotics  Sytstem</span>
<span class="sd"> Section (347) at the Jet  Propulsion  Laboratory.   Suggestions and patches</span>
<span class="sd"> are welcome and should be sent to the software&#39;s maintainer.</span>
<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># pylint:disable=E1101</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cplex</span>  <span class="c1"># This will be problematic on ARM</span>
    <span class="n">CPLEXAvailable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">CPLEXAvailable</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Install pyglpk by bradforboyle. Will not work with Python-GLPK.</span>
    <span class="kn">import</span> <span class="nn">glpk</span>
    <span class="n">GLPKAvailable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">GLPKAvailable</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyscipopt</span> <span class="k">as</span> <span class="nn">scip</span>
    <span class="n">SCIPAvailable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">SCIPAvailable</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">mosaic_schedulers.common.utilities.contact_plan_handler</span> <span class="kn">import</span> <span class="n">compute_time_invariant_bandwidth</span>


<div class="viewcode-block" id="MILPTasks"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MILPTasks">[docs]</a><span class="k">class</span> <span class="nc">MILPTasks</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class containing a representation of the tasks for the MILP scheduler.</span>

<span class="sd">    :param OptionalTasks: a dict with Tasks as keys. OT[Task] is True iff the task</span>
<span class="sd">       is optional.</span>
<span class="sd">    :type OptionalTasks: dict</span>
<span class="sd">    :param TaskReward: a dict with Tasks as keys. TR[Task] is the reward obtained</span>
<span class="sd">       for performing the task, a float.</span>
<span class="sd">    :type TaskReward: dict</span>
<span class="sd">    :param ProductsBandwidth: a dict with Tasks as keys. PB[Task] is the bandwidth</span>
<span class="sd">       required to stream of the products of Task (in storage units per time</span>
<span class="sd">       units), a float.</span>
<span class="sd">    :type ProductsBandwidth: dict</span>
<span class="sd">    :param ProductsDataSize: a dict with Tasks as keys. PDS[Task] is the size of the</span>
<span class="sd">       products of Task (in storage units), a float.</span>
<span class="sd">    :type ProductsDataSize: dict</span>
<span class="sd">    :param DependencyList: a dict with Tasks as keys. DL[Task] is a list</span>
<span class="sd">       of tasks whose data products are required to compute Task.</span>
<span class="sd">    :type DependencyList: dict</span>
<span class="sd">    :param MaxLatency: a dict with keys task1, task2. MaxLatency[T1][T2] is the maximum</span>
<span class="sd">       latency that the data products of T2 (a dependency of T1) can tolerate</span>
<span class="sd">       before they are ingested by task T1.</span>
<span class="sd">    :type MaxLatency: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">OptionalTasks</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">TaskReward</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">ProductsBandwidth</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">ProductsDataSize</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">DependencyList</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">MaxLatency</span><span class="o">=</span><span class="p">{},</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OptionalTasks</span> <span class="o">=</span> <span class="n">OptionalTasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskReward</span> <span class="o">=</span> <span class="n">TaskReward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ProductsBandwidth</span> <span class="o">=</span> <span class="n">ProductsBandwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ProductsDataSize</span> <span class="o">=</span> <span class="n">ProductsDataSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span> <span class="o">=</span> <span class="n">DependencyList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaxLatency</span> <span class="o">=</span> <span class="n">MaxLatency</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

<div class="viewcode-block" id="MILPTasks.validate"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MILPTasks.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ensure the Tasks structure is valid, i.e. the keys to the various </span>
<span class="sd">        components are consistent &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ProductsDataSize</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaxLatency</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaxLatency</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaxLatency</span><span class="p">[</span><span class="n">task</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">task</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  <span class="c1"># If this is not empty</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TaskReward</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RequiringTasks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">child</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">parent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">child</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="MILPAgentCapabilities"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MILPAgentCapabilities">[docs]</a><span class="k">class</span> <span class="nc">MILPAgentCapabilities</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class containing a representation of the agent capabilities for the</span>
<span class="sd">    MILP scheduler.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    :param ComputationLoad: a dictionary with keys Agent, Task. The value of</span>
<span class="sd">      ComputationLoad[Agent][Task] is the amount of Agent&#39;s computational</span>
<span class="sd">      resources required to complete Task.</span>
<span class="sd">    :type ComputationLoad: dict</span>
<span class="sd">    :param EnergyCost: a dictionary with keys Agent, Task. EnergyCost[A][T] is the</span>
<span class="sd">      energy cost when agent A computes task T.</span>
<span class="sd">    :type EnergyCost: dict</span>
<span class="sd">    :param MaxComputationLoad: a dict with keys Agents. MaxComputationLoad[A] is the</span>
<span class="sd">      maximum computational resources of agent A.</span>
<span class="sd">    :type MaxComputationLoad: dict</span>
<span class="sd">    :param LinkComputationalLoadIn: a dict with keys Agent, Agent.</span>
<span class="sd">      LinkComputationalLoadIn[A1][A2] is the computational load required to</span>
<span class="sd">      decode messages on link [A1][A2] at A2.</span>
<span class="sd">    :type LinkComputationalLoadIn: dict</span>
<span class="sd">    :param LinkComputationalLoadOut: a dict with keys Agent, Agent.</span>
<span class="sd">      LinkComputationalLoadOut[A1][A2] is the computational load required to</span>
<span class="sd">      encode messages on link [A1][A2] at A1.</span>
<span class="sd">    :type LinkComputationalLoadOut: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">ComputationLoad</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">EnergyCost</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">MaxComputationLoad</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">LinkComputationalLoadIn</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">LinkComputationalLoadOut</span><span class="o">=</span><span class="p">{},</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ComputationLoad</span> <span class="o">=</span> <span class="n">ComputationLoad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnergyCost</span> <span class="o">=</span> <span class="n">EnergyCost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaxComputationLoad</span> <span class="o">=</span> <span class="n">MaxComputationLoad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LinkComputationalLoadIn</span> <span class="o">=</span> <span class="n">LinkComputationalLoadIn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LinkComputationalLoadOut</span> <span class="o">=</span> <span class="n">LinkComputationalLoadOut</span></div>


<div class="viewcode-block" id="CommunicationNetwork"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.CommunicationNetwork">[docs]</a><span class="k">class</span> <span class="nc">CommunicationNetwork</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A class containing the properties of the communication network</span>
<span class="sd">    used by the time-invariant scheduler.</span>
<span class="sd">    </span>
<span class="sd">    :param Bandwidth: a dictionary with keys Agent, Agent. Bandwidth[A1][A2]</span>
<span class="sd">      is the bandwidth from agent A1 to agent A2. If Bandwidth[A1][A2]</span>
<span class="sd">      is zero, the link is not considered in the optimization problem.</span>
<span class="sd">    :type Bandwidth: dict</span>
<span class="sd">    :param Latency: a dictionary with keys Agent, Agent. Latency[A1][A2] is</span>
<span class="sd">      the latency of the link. Note that the latency of a datagram should</span>
<span class="sd">      be (but isn&#39;t at this time) computed as Latency[A1][A2] +</span>
<span class="sd">      datagram_size/Bandwidth[A1][A2].</span>
<span class="sd">    :type Latency: dict</span>
<span class="sd">    :param EnergyCost: a dictionary with keys Agent, Agent. EnergyCost[A1][A2]</span>
<span class="sd">      is the energy cost to transmit one bit on link A1-A2. The actual</span>
<span class="sd">      energy cost is computed as EnergyCost[A1][A2]*bit_rate[A1][A2].</span>
<span class="sd">    :type EnergyCost: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">Bandwidth</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">Latency</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">EnergyCost</span><span class="o">=</span><span class="p">{},</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bandwidth</span> <span class="o">=</span> <span class="n">Bandwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Latency</span> <span class="o">=</span> <span class="n">Latency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnergyCost</span> <span class="o">=</span> <span class="n">EnergyCost</span></div>


<div class="viewcode-block" id="JSONSolver"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.JSONSolver">[docs]</a><span class="k">class</span> <span class="nc">JSONSolver</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of the time-invariant problem based on a problem input in the format</span>
<span class="sd">    described in the :doc:`API`.</span>

<span class="sd">    :param JSONProblemDescription: a JSON description of the problem. See the :doc:`API` for a detailed description.</span>
<span class="sd">    :type JSONProblemDescription: str, optional</span>
<span class="sd">    :param Verbose: whether to print status and debug messages. Defaults to False</span>
<span class="sd">    :type Verbose: bool, optional</span>
<span class="sd">    :param solver: the solver to use. Should be &#39;GLPK&#39;, &#39;CPLEX&#39;, or &#39;SCIP&#39;, defaults to &#39;GLPK&#39;.</span>
<span class="sd">    :type solver: str, optional</span>
<span class="sd">    :param TimeLimit: a time limit after which to stop the optimizer. Defaults to None (no time limit).</span>
<span class="sd">                      Note that certain solvers (in particular, GLPK) may not honor the time limit.</span>
<span class="sd">    :type TimeLimit: float, optional</span>
<span class="sd">    :raises AssertionError: if the JSONProblemDescription is not valid.</span>

<span class="sd">    .. warning ::</span>
<span class="sd">       </span>
<span class="sd">       This solver does not support disjunctive prerequirements (do this task OR that task).</span>
<span class="sd">       If a problem with disjunctive prerequirement is passed, the solver will assert.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">JSONProblemDescription</span><span class="p">,</span>
                 <span class="n">Verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;GLPK&#39;</span><span class="p">,</span>
                 <span class="n">TimeLimit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">solver</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GLPK&#39;</span><span class="p">,</span> <span class="s1">&#39;CPLEX&#39;</span><span class="p">,</span> <span class="s1">&#39;SCIP&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">CPLEXAvailable</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: invalid solver. Defaulting to CPLEX&quot;</span><span class="p">)</span>
                <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;CPLEX&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: invalid solver. Defaulting to GLPK&quot;</span><span class="p">)</span>
                <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;GLPK&quot;</span>
        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;CPLEX&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">CPLEXAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: CPLEX not available. Switching to GLPK&quot;</span><span class="p">)</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;GLPK&quot;</span>

        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;SCIP&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SCIPAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: SCIP not available. Switching to GLPK&quot;</span><span class="p">)</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;GLPK&quot;</span>

        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;GLPK&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">GLPKAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: GLPK not available. Aborting.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">JSONProblemDescription</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">JSONInput</span> <span class="o">=</span> <span class="n">JSONProblemDescription</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Attempt to deserialize</span>
            <span class="n">JSONInput</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">JSONProblemDescription</span><span class="p">)</span>

        <span class="c1"># Time</span>
        <span class="n">Thor</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="s2">&quot;Thor&quot;</span><span class="p">]</span>

        <span class="c1"># Tasks</span>
        <span class="c1"># Translate tasks to TI format. Check that disjunctive requirements are not included</span>
        <span class="n">DepList</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;DependencyList&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;DependencyList&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">]:</span>
                <span class="n">DepList</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;DependencyList&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">dep</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
                            <span class="n">dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Disjunctive prerequirements are not supported&#39;</span>
                        <span class="n">DepList</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dep</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">DepList</span><span class="p">[</span><span class="n">task</span><span class="p">]:</span>  <span class="c1"># If the list is empty, pop it</span>
                    <span class="n">DepList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="c1"># Convert products size to average bandwidth needed</span>
        <span class="n">PrBw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;ProductsSize&quot;</span><span class="p">]:</span>
            <span class="c1"># Average bandwidth to finish by the end of the horizon</span>
            <span class="n">PrBw</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">]</span>
                               <span class="p">[</span><span class="s2">&quot;ProductsSize&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span>

        <span class="c1"># Clean up latency by removing entries corresponding to dependencies that have been removed</span>
        <span class="c1"># This will ensure that the MILPTasks object is valid, specifically that DependencyList</span>
        <span class="c1"># and MaxLatency have the same keys</span>
        <span class="n">MaxLatency</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;MaxLatency&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;MaxLatency&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">]:</span>
                <span class="n">MaxLatency</span><span class="p">[</span><span class="n">task</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;MaxLatency&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">]</span>

        <span class="n">Tasks</span> <span class="o">=</span> <span class="n">MILPTasks</span><span class="p">(</span>
            <span class="n">OptionalTasks</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;OptionalTasks&quot;</span><span class="p">],</span>
            <span class="n">TaskReward</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;TaskReward&quot;</span><span class="p">],</span>
            <span class="n">ProductsDataSize</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;ProductsSize&quot;</span><span class="p">],</span>
            <span class="n">ProductsBandwidth</span><span class="o">=</span><span class="n">PrBw</span><span class="p">,</span>
            <span class="n">DependencyList</span><span class="o">=</span><span class="n">DepList</span><span class="p">,</span>
            <span class="n">MaxLatency</span><span class="o">=</span><span class="n">MaxLatency</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Agent capabilities</span>

        <span class="c1"># Convert computational load from instantaneous to average</span>
        <span class="n">CompLoad</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;ComputationTime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;ComputationTime&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">agent</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CompLoad</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">CompLoad</span><span class="p">[</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">CompLoad</span><span class="p">[</span><span class="n">agent</span><span class="p">][</span><span class="n">task</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;ComputationLoad&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">][</span><span class="n">agent</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span>
                    <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;ComputationTime&quot;</span><span class="p">][</span><span class="n">task</span><span class="p">][</span><span class="n">agent</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span>
        <span class="n">TILinkLoadIn</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;LinkComputationalLoadIn&quot;</span><span class="p">]</span>
        <span class="n">TILinkLoadOut</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;LinkComputationalLoadOut&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">agent1</span> <span class="ow">in</span> <span class="n">TILinkLoadIn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">agent2</span> <span class="ow">in</span> <span class="n">TILinkLoadIn</span><span class="p">[</span><span class="n">agent1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">TILinkLoadIn</span><span class="p">[</span><span class="n">agent1</span><span class="p">][</span><span class="n">agent2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">TILinkLoadIn</span><span class="p">[</span><span class="n">agent1</span><span class="p">][</span><span class="n">agent2</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span>
                <span class="n">TILinkLoadOut</span><span class="p">[</span><span class="n">agent1</span><span class="p">][</span><span class="n">agent2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">TILinkLoadOut</span><span class="p">[</span><span class="n">agent1</span><span class="p">][</span><span class="n">agent2</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span>

        <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="n">MILPAgentCapabilities</span><span class="p">(</span>
            <span class="n">ComputationLoad</span><span class="o">=</span><span class="n">CompLoad</span><span class="p">,</span>
            <span class="n">EnergyCost</span><span class="o">=</span><span class="n">flipNestedDictionary</span><span class="p">(</span>
                <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;EnergyCost&quot;</span><span class="p">]),</span>
            <span class="n">MaxComputationLoad</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;MaxComputationLoad&quot;</span><span class="p">],</span>
            <span class="n">LinkComputationalLoadIn</span><span class="o">=</span><span class="n">TILinkLoadIn</span><span class="p">,</span>
            <span class="n">LinkComputationalLoadOut</span><span class="o">=</span><span class="n">TILinkLoadOut</span>
        <span class="p">)</span>
        <span class="c1"># Communication network</span>
        <span class="n">TVBandwidth</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;CommunicationNetwork&quot;</span><span class="p">]</span>

        <span class="n">Bandwidth</span><span class="p">,</span> <span class="n">Latency</span><span class="p">,</span> <span class="n">EnergyCost</span> <span class="o">=</span> <span class="n">compute_time_invariant_bandwidth</span><span class="p">(</span>
            <span class="n">agents_list</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;MaxComputationLoad&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
            <span class="p">),</span>
            <span class="n">TVBandwidth</span><span class="o">=</span><span class="n">TVBandwidth</span><span class="p">,</span>
            <span class="n">Thor</span><span class="o">=</span><span class="n">Thor</span><span class="p">)</span>

        <span class="n">CommNet</span> <span class="o">=</span> <span class="n">CommunicationNetwork</span><span class="p">(</span>
            <span class="n">Bandwidth</span><span class="o">=</span><span class="n">Bandwidth</span><span class="p">,</span>
            <span class="n">Latency</span><span class="o">=</span><span class="n">Latency</span><span class="p">,</span>
            <span class="n">EnergyCost</span><span class="o">=</span><span class="n">EnergyCost</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Options</span>
        <span class="n">Options</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Options&quot;</span><span class="p">]</span>

        <span class="c1"># Create the problem</span>
        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;GLPK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICGLPKSolver</span><span class="p">(</span>
                <span class="n">AgentCapabilities</span><span class="o">=</span><span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="o">=</span><span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommunicationNetwork</span><span class="o">=</span><span class="n">CommNet</span><span class="p">,</span>
                <span class="n">Options</span><span class="o">=</span><span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span><span class="o">=</span><span class="n">Verbose</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;CPLEX&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICCPLEXSolver</span><span class="p">(</span>
                <span class="n">AgentCapabilities</span><span class="o">=</span><span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="o">=</span><span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommunicationNetwork</span><span class="o">=</span><span class="n">CommNet</span><span class="p">,</span>
                <span class="n">Options</span><span class="o">=</span><span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span><span class="o">=</span><span class="n">Verbose</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;SCIP&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICSCIPSolver</span><span class="p">(</span>
                <span class="n">AgentCapabilities</span><span class="o">=</span><span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="o">=</span><span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommunicationNetwork</span><span class="o">=</span><span class="n">CommNet</span><span class="p">,</span>
                <span class="n">Options</span><span class="o">=</span><span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span><span class="o">=</span><span class="n">Verbose</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: unsupported solver (how did you get here?)&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">setTimeLimits</span><span class="p">(</span><span class="n">ClockTimeLimit</span><span class="o">=</span><span class="n">TimeLimit</span><span class="p">)</span>

<div class="viewcode-block" id="JSONSolver.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.JSONSolver.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Solve the scheduling problem.</span>

<span class="sd">        :return: A solution in the JSON format described in the :doc:`API`.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">schedule</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">formatToBenchmarkIO</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="MOSAICMILPSolver"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver">[docs]</a><span class="k">class</span> <span class="nc">MOSAICMILPSolver</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. warning ::</span>
<span class="sd">       </span>
<span class="sd">       For an easier-to-use and more consistent interface, you most likely want to call</span>
<span class="sd">       :class:`JSONSolver` instead of this class and its subclasses.</span>

<span class="sd">    Abstract implementation of the MILP task allocator.</span>
<span class="sd">    Subclassed by :class:`MOSAICCPLEXSolver`, :class:`MOSAICSCIPSolver`, and :class:`MOSAICGLPKSolver`.</span>


<span class="sd">    :param AgentCapabilities: detailing what the agents can do</span>
<span class="sd">    :type AgentCapabilities: MOSAICTISolver.MILPAgentCapabilities</span>
<span class="sd">    :param Tasks: detailing the tasks that must be achieved</span>
<span class="sd">    :type Tasks: MOSAICTISolver.MILPTasks</span>
<span class="sd">    :param CommunicationNetwork: detailing the communication network availability</span>
<span class="sd">    :type CommunicationNetwork: MOSAICTISolver.CommunicationNetwork</span>
<span class="sd">    :param Options:  additional solver-specific options, defaults to {}</span>
<span class="sd">    :type Options: dict, optional</span>
<span class="sd">    :param Verbose: if True, prints status and debug messages. Defaults to False</span>
<span class="sd">    :type Verbose: bool, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">AgentCapabilities</span><span class="p">,</span>
                 <span class="n">Tasks</span><span class="p">,</span>
                 <span class="n">CommunicationNetwork</span><span class="p">,</span>
                 <span class="n">Options</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">Verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="n">AgentCapabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span> <span class="o">=</span> <span class="n">Tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span> <span class="o">=</span> <span class="n">CommunicationNetwork</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Options</span> <span class="o">=</span> <span class="n">Options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="o">=</span> <span class="n">Verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">JSONIsFormed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solverSpecificInit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: removing bandwidth self-loop for agent </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<div class="viewcode-block" id="MOSAICMILPSolver.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.solverSpecificInit">[docs]</a>    <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; A place to define solver-specific initializations in subclasses &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_verbprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_str</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Helper function to only print if the verbose flag is set&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">_str</span><span class="p">)</span>

<div class="viewcode-block" id="MOSAICMILPSolver.getRawOutput"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.getRawOutput">[docs]</a>    <span class="k">def</span> <span class="nf">getRawOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return raw problem output from the scheduler &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set up and solve the scheduling problem &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span><span class="p">)</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.setTimeLimits">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets a time limit for the overall process. May be ignored by certain</span>
<span class="sd">        solvers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.setSolverParameters"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.setSolverParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Passes a dictionary of parameters to the solver</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set up the optimization problem. Solver-specific. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Solve the optimization problem. Solver-specific. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.setMIPStart"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.setMIPStart">[docs]</a>    <span class="k">def</span> <span class="nf">setMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MIPStart</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Provide a warm start to the solver. Solver-specific. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.getSolverState">[docs]</a>    <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the solver state. Solver-specific. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.getProblem">[docs]</a>    <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the solver problem object. &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.getOptimizationTerminator"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.getOptimizationTerminator">[docs]</a>    <span class="k">def</span> <span class="nf">getOptimizationTerminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets an object that can be called to stop the optimization process &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPSolver.formatToBenchmarkIO"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICMILPSolver.formatToBenchmarkIO">[docs]</a>    <span class="k">def</span> <span class="nf">formatToBenchmarkIO</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Formats the scheduler output to the JSON format described in the :doc:`API` &#39;&#39;&#39;</span>
        <span class="n">tasks_output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Calling solver&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># AgentsList = list(self.AgentCapabilities.ComputationLoad[TasksList[0]].keys())</span>
        <span class="c1"># TaskSchedule = self.TaskAssignment[&#39;TaskSchedule&#39;]</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">]</span>
        <span class="c1"># ComputationTime = None #self.AgentCapabilities.ComputationTime</span>
        <span class="c1"># TimeStep = self.TimeStep</span>
        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span>

        <span class="k">for</span> <span class="n">taskid</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">TaskAgent</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">_agent</span> <span class="o">=</span> <span class="n">TaskAgent</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span>
                <span class="n">_time</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># float(TaskSchedule[taskid]) * TimeStep</span>
                <span class="c1"># float(ComputationTime[taskid][_agent]) * TimeStep</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">_name</span> <span class="o">=</span> <span class="n">taskid</span>
                <span class="n">task_output</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">_name</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">_name</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;agent&quot;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="n">tasks_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_output</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">CommSchedule</span><span class="p">:</span>
            <span class="n">_agent</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_time</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># float(comm[3]) * TimeStep</span>
            <span class="n">_bandwidth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">comm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">_taskname</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">_receiver</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">_duration</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># product size / _bandwidth</span>
            <span class="n">task_output</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;transfer_data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;transfer_data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;transmitter&quot;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                    <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">_taskname</span><span class="p">,</span>
                    <span class="s2">&quot;agent&quot;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                    <span class="s2">&quot;receiver&quot;</span><span class="p">:</span> <span class="n">_receiver</span><span class="p">,</span>
                    <span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="n">_bandwidth</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
            <span class="n">tasks_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_output</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">sort_by_time</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
        <span class="n">tasks_output</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sort_by_time</span><span class="p">)</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tasks&quot;</span><span class="p">:</span> <span class="n">tasks_output</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">out_dict</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="n">CPLEXAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MOSAICCPLEXSolver</span><span class="p">(</span><span class="n">MOSAICMILPSolver</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A dummy implementation of the MILP scheduler if CPLEX is not available.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: CPLEX not installed. This will not work.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="MOSAICCPLEXSolver"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICCPLEXSolver">[docs]</a>    <span class="k">class</span> <span class="nc">MOSAICCPLEXSolver</span><span class="p">(</span><span class="n">MOSAICMILPSolver</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An implementation of the MILP scheduler that uses the IBM ILOG CPLEX solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICCPLEXSolver.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICCPLEXSolver.solverSpecificInit">[docs]</a>        <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

            <span class="c1"># Create the CPLEX problem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span> <span class="o">=</span> <span class="n">cplex</span><span class="o">.</span><span class="n">Cplex</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">objective</span><span class="o">.</span><span class="n">set_sense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">objective</span><span class="o">.</span><span class="n">sense</span><span class="o">.</span><span class="n">minimize</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">use_aborter</span><span class="p">(</span><span class="n">cplex</span><span class="o">.</span><span class="n">Aborter</span><span class="p">())</span></div>

        <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># This used to be a part of a larger function.</span>
            <span class="c1"># By redefining these variables as local, we save a lot of typing</span>
            <span class="c1">#  and possible errors.</span>
            <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
            <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
            <span class="n">CommBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span>
            <span class="n">LinkLatency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Latency</span>
            <span class="c1"># Options = self.Options</span>

            <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># We find things</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">X</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">X_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">X_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">X_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">X_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">])</span>
                    <span class="n">X_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span><span class="o">*</span><span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                    <span class="n">X_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;X[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
            <span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">ix</span>

            <span class="n">B</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">B_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">B_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">B_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">B_upper_bound</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                            <span class="n">B_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;B[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
                            <span class="n">B_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">B_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                            <span class="n">B_upper_bound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">b_vars_len</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">x_vars_len</span>

            <span class="n">communication_cost_optional_tasks</span> <span class="o">=</span> <span class="mf">1e-8</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">C_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">C_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">C_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">C_upper_bound</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                                <span class="n">C_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="s1">&#39;C[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mm</span><span class="p">))</span>
                                <span class="n">C_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                                <span class="n">C_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">communication_cost_optional_tasks</span><span class="p">)</span>
                                <span class="n">C_upper_bound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                                <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">b_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

            <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">CostFunction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

            <span class="n">X_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">X_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">B_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">B_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">B_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">C_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">C_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">C_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># We create the variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">X_cost</span><span class="p">,</span>
                                   <span class="n">lb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vars_len</span><span class="p">,</span>
                                   <span class="n">ub</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vars_len</span><span class="p">,</span>
                                   <span class="n">types</span><span class="o">=</span><span class="p">[</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">binary</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vars_len</span><span class="p">,</span>
                                   <span class="n">names</span><span class="o">=</span><span class="n">X_name</span><span class="p">,</span>
                                   <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">B_cost</span><span class="p">,</span>
                                   <span class="n">lb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b_vars_len</span><span class="p">,</span>
                                   <span class="n">ub</span><span class="o">=</span><span class="n">B_upper_bound</span><span class="p">,</span>
                                   <span class="n">types</span><span class="o">=</span><span class="p">[</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">continuous</span><span class="p">]</span> <span class="o">*</span> <span class="n">b_vars_len</span><span class="p">,</span>
                                   <span class="n">names</span><span class="o">=</span><span class="n">B_name</span><span class="p">,</span>
                                   <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">obj</span><span class="o">=</span><span class="n">C_cost</span><span class="p">,</span>
                <span class="n">lb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">comm_vars_length</span><span class="p">,</span>
                <span class="n">ub</span><span class="o">=</span><span class="n">C_upper_bound</span><span class="p">,</span>
                <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">continuous</span><span class="p">]</span> <span class="o">*</span> <span class="n">comm_vars_length</span><span class="p">,</span>
                <span class="n">names</span><span class="o">=</span><span class="n">C_name</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Constraints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done (1b)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">],</span> <span class="p">[</span>
                                     <span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
                <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;G&#39;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">],</span>
                <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done once&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">],</span>
                <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">],</span>
                <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Data Transmission (1c)&quot;</span><span class="p">)</span>
            <span class="n">DCConstraintsList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                        <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">],</span>  <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">tau</span><span class="p">]]</span>
                        <span class="n">CoeffsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="o">-</span>
                                      <span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
                        <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">DCConstraintsList</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffsList</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">lin_expr</span><span class="o">=</span><span class="n">DCConstraintsList</span><span class="p">,</span>
                <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">DCConstraintsList</span><span class="p">),</span>
                <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">DCConstraintsList</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Multiplexed bandwidth (1d)&quot;</span><span class="p">)</span>
            <span class="n">MPConstraintsList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                                <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]]</span>
                                <span class="n">CoeffsList</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                                <span class="n">MPConstraintsList</span> <span class="o">+=</span> <span class="p">[</span>
                                    <span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffsList</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">lin_expr</span><span class="o">=</span><span class="n">MPConstraintsList</span><span class="p">,</span>
                <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">MPConstraintsList</span><span class="p">),</span>
                <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">MPConstraintsList</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Resource availability</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability (1e)&quot;</span><span class="p">)</span>
            <span class="n">RAConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">MaxAgentLoad</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">]</span>
                <span class="n">CoeffsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">]</span>
                <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                             <span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">LinkComputationalLoadIn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                             <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">LinkComputationalLoadOut</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">RAConstraintList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffsList</span><span class="p">)]</span>
                <span class="n">MaxAgentLoad</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">MaxComputationLoad</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="n">RAConstraintList</span><span class="p">,</span>
                                            <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">RAConstraintList</span><span class="p">),</span>
                                            <span class="n">rhs</span><span class="o">=</span><span class="n">MaxAgentLoad</span><span class="p">)</span>

            <span class="c1"># self._verbprint(&quot;Constraint: Bandwidth (1f)&quot;)</span>
            <span class="c1"># self.cpx.linear_constraints.add(</span>
            <span class="c1">#     lin_expr = [</span>
            <span class="c1">#         cplex.SparsePair(</span>
            <span class="c1">#             [B[i][j][m] for m in TasksList], [1 for m in TasksList]</span>
            <span class="c1">#         ) for i in AgentsList for j in AgentsList if CommBandwidth[i][j]&gt;0</span>
            <span class="c1">#     ],</span>
            <span class="c1">#     senses = [&#39;L&#39; for i in AgentsList for j in AgentsList if CommBandwidth[i][j]&gt;0],</span>
            <span class="c1">#     rhs = [CommBandwidth[i][j]  for i in AgentsList for j in AgentsList if CommBandwidth[i][j]&gt;0]</span>
            <span class="c1"># )</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Latency (1g)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[(</span><span class="n">LinkLatency</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsDataSize</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span>
                <span class="p">],</span>
                <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">mm</span><span class="p">]],</span>
                <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="n">Tasks</span><span class="o">.</span><span class="n">MaxLatency</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                     <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">mm</span><span class="p">]]</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Setup time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">x_vars_len</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span> <span class="o">=</span> <span class="n">b_vars_len</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">comm_vars_length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
            <span class="n">SolveStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">set_log_stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">set_warning_stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">set_results_stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solution status:                   </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">is_primal_feasible</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_objective_value</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s1">&#39;Optimal value:                     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
                <span class="c1"># Solution in MIP Start format</span>
                <span class="n">varNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>
                <span class="n">varValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">varNames</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CPLEXSol</span> <span class="o">=</span> <span class="p">[</span><span class="n">varNames</span><span class="p">,</span> <span class="n">varValues</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get_num</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SolveStartTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solve time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span><span class="p">))</span>

            <span class="c1"># This is post-processing and should probably be moved to a different function so it can be called on an existing solution.</span>
            <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># This is a ugly hack. Sometimes CPLEX will return weird fractional solutions even if we require integral ones. Here, we round.</span>
            <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                        <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                    <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">:</span> <span class="n">TaskAgent</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">}</span>

            <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]]])</span>

            <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">]</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span><span class="p">]</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span><span class="p">:]</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status_string</span><span class="p">()</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Total time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Cplex problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">is_primal_feasible</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">getMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CPLEXSol</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">setMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MIPStart</span><span class="p">,</span> <span class="n">effort_level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="c1"># If the MIP start is infeasible, how hard do we try to patch it?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">MIP_starts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MIPStart</span><span class="p">,</span> <span class="n">effort_level</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Override to implement time limit</span>
            <span class="n">startSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
            <span class="n">endSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSetupTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Setup time (s): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSetupTime</span><span class="p">))</span>
            <span class="c1"># Set clock time limit</span>
            <span class="n">overallTimeLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timelimit</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overallTimeLimit</span><span class="p">))</span>
            <span class="n">solverTimeLimit</span> <span class="o">=</span> <span class="n">overallTimeLimit</span> <span class="o">-</span> <span class="n">endSetupTime</span>
            <span class="k">if</span> <span class="n">solverTimeLimit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Setting solver time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solverTimeLimit</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timelimit</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">solverTimeLimit</span><span class="p">)</span>
            <span class="n">startSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
            <span class="n">endSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSolveTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solution time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">endSolveTime</span> <span class="o">+</span> <span class="n">endSetupTime</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Solver not called&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>

        <span class="k">def</span> <span class="nf">writeSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;MIPstarts&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">writelevel</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">MIP_starts</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.mps&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.sol&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">getOptimizationTerminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39; Gets an object that can be called to stop the optimization process.</span>
<span class="sd">                To actually terminate the problem, call the method abort() of the</span>
<span class="sd">                returned object.</span>
<span class="sd">                &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span>

        <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">):</span>
            <span class="c1"># Deterministic time limit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">dettimelimit</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">DetTicksLimit</span><span class="p">)</span>
            <span class="c1"># clock time limit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timelimit</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ClockTimeLimit</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">Properties</span><span class="p">:</span>
                <span class="n">propset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span>
                <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                    <span class="n">propset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">propset</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
                <span class="n">propset</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Properties</span><span class="p">[</span><span class="n">param</span><span class="p">])</span></div>


<span class="k">if</span> <span class="n">GLPKAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MOSAICGLPKSolver</span><span class="p">(</span><span class="n">MOSAICMILPSolver</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A dummy implementation of the MILP scheduler if GLPK is not available.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: GLPK not installed. This will not work.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="MOSAICGLPKSolver"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver">[docs]</a>    <span class="k">class</span> <span class="nc">MOSAICGLPKSolver</span><span class="p">(</span><span class="n">MOSAICMILPSolver</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An implementation of the MILP scheduler that uses the GLPK solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICGLPKSolver.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.solverSpecificInit">[docs]</a>        <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Create the GLPK problem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span> <span class="o">=</span> <span class="n">glpk</span><span class="o">.</span><span class="n">LPX</span><span class="p">()</span>
            <span class="c1"># self.cpx.kind = int</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">maximize</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># No aborter for now</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="mf">1e75</span></div>

<div class="viewcode-block" id="MOSAICGLPKSolver.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.setUp">[docs]</a>        <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># This used to be a part of a larger function.</span>
            <span class="c1"># By redefining these variables as local, we save a lot of typing</span>
            <span class="c1">#  and possible errors.</span>
            <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
            <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
            <span class="n">CommBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span>
            <span class="n">LinkLatency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Latency</span>
            <span class="c1"># Options = self.Options</span>

            <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># We find things</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">X</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">X_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">X_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">X_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">X_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">])</span>
                    <span class="n">X_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span><span class="o">*</span><span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                    <span class="n">X_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;X[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
            <span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">ix</span>

            <span class="n">B</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">B_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">B_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">B_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">B_upper_bound</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                            <span class="n">B_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;B[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
                            <span class="n">B_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">B_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                            <span class="n">B_upper_bound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">b_vars_len</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">x_vars_len</span>

            <span class="n">communication_cost_optional_tasks</span> <span class="o">=</span> <span class="mf">1e-8</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">C_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">C_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">C_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">C_upper_bound</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                                <span class="n">C_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="s1">&#39;C[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mm</span><span class="p">))</span>
                                <span class="n">C_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                                <span class="n">C_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">communication_cost_optional_tasks</span><span class="p">)</span>
                                <span class="n">C_upper_bound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                                <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">b_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

            <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">CostFunction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

            <span class="n">X_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">X_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">B_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">B_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">B_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">C_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="n">C_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">C_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># We create the variables</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col_ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                <span class="c1"># c.bounds = 0., 1.</span>
                <span class="n">c</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="nb">bool</span>
                <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">X_name</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_cost</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">B_cost</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B_cost</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">col_ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">B_cost</span><span class="p">)):</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)]</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="nb">float</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">B_upper_bound</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">B_name</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)]</span> <span class="o">=</span> <span class="n">B_cost</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">C_cost</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C_cost</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">col_ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C_cost</span><span class="p">)):</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">B_cost</span><span class="p">)]</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="nb">float</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">C_upper_bound</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">C_name</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)</span> <span class="o">+</span>
                                 <span class="nb">len</span><span class="p">(</span><span class="n">B_cost</span><span class="p">)]</span> <span class="o">=</span> <span class="n">C_cost</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>

            <span class="c1"># Constraints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done (1b)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
                                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done once&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">1.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Data Transmission (1c)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                        <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">],</span>  <span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">tau</span><span class="p">]]</span>
                        <span class="n">CoeffsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="o">-</span>
                                      <span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
                        <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                                     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffsList</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="kc">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Multiplexed bandwidth (1d)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                                <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]]</span>
                                <span class="n">CoeffsList</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span>
                                                               <span class="n">CoeffsList</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.</span>

            <span class="c1"># Resource availability</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability (1e)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">]</span>
                <span class="n">CoeffsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">]</span>
                <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                             <span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">LinkComputationalLoadIn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                             <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">CoeffsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">LinkComputationalLoadOut</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                               <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffsList</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">MaxComputationLoad</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Latency (1g)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">mm</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">],</span> <span class="p">(</span><span class="n">LinkLatency</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsDataSize</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">MaxLatency</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Setup time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">x_vars_len</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span> <span class="o">=</span> <span class="n">b_vars_len</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">comm_vars_length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICGLPKSolver.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.solve">[docs]</a>        <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
            <span class="n">SolveStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">glpk</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">term_on</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">LPisFeasible</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># We need this to build a feasible optimal basis. This is slow and annoying, and we will need a workaround.</span>
            <span class="c1"># retval_lp = self.cpx.interior()</span>
            <span class="n">start_lp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solving simplex&quot;</span><span class="p">)</span>
            <span class="n">cpx_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;presolve&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">!=</span> <span class="mf">1e75</span><span class="p">:</span>
                <span class="n">cpx_kwargs</span><span class="p">[</span><span class="s1">&#39;tm_lim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>  <span class="c1"># Convert to ms</span>
            <span class="n">retval_lp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">simplex</span><span class="p">(</span><span class="o">**</span><span class="n">cpx_kwargs</span><span class="p">)</span>
            <span class="n">end_lp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_lp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Simplex solved in </span><span class="si">{}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_lp</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">retval_lp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;opt&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;feas&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solving IP&quot;</span><span class="p">)</span>
                <span class="n">LPisFeasible</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">start_ip</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span><span class="o">**</span><span class="n">cpx_kwargs</span><span class="p">)</span>
                <span class="n">end_ip</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ip</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;MILP solved in </span><span class="si">{}</span><span class="s2"> s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end_ip</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s1">&#39;Solution status:                   </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">LPisFeasible</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;opt&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;feas&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s1">&#39;Optimal value:                     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">))</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">value_m</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SolveStartTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solve time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span><span class="p">))</span>

            <span class="c1"># This is post-processing and should probably be moved to a different function so it can be called on an existing solution.</span>
            <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># This is a ugly hack. Sometimes the solver will return weird fractional solutions even if we require integral ones. Here, we round.</span>
            <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                        <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                    <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">:</span> <span class="n">TaskAgent</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">}</span>

            <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]]])</span>

            <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">]</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span><span class="p">]</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span><span class="p">:]</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Total time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;GLPK problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICGLPKSolver.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.schedule">[docs]</a>        <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Override to implement time limit</span>
            <span class="n">startSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
            <span class="n">endSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSetupTime</span>
            <span class="n">startSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
            <span class="n">endSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSolveTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solution time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">endSolveTime</span> <span class="o">+</span> <span class="n">endSetupTime</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span><span class="p">)</span></div>

<div class="viewcode-block" id="MOSAICGLPKSolver.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.getSolverState">[docs]</a>        <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Solver not called&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span></div>

<div class="viewcode-block" id="MOSAICGLPKSolver.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.getProblem">[docs]</a>        <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span></div>

        <span class="k">def</span> <span class="nf">writeSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;MIPstarts_GLPK&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">writelevel</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mps</span><span class="o">=</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_problem.mps&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mip</span><span class="o">=</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.mps&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sol</span><span class="o">=</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.sol&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="MOSAICGLPKSolver.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICGLPKSolver.setTimeLimits">[docs]</a>        <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">DetTicksLimit</span> <span class="o">!=</span> <span class="mf">1e75</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: deterministic ticks limit ignored by GLPK&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ClockTimeLimit</span> <span class="o">!=</span> <span class="mf">1e75</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: clock time limit partly nonfunctional in GLPK&quot;</span><span class="p">)</span>
                <span class="c1"># pyglpk does not implement calling intop</span>
                <span class="c1"># (it says it does but it calls .integer)</span>
                <span class="c1"># The &#39;integer&#39; solver requires a basis</span>
                <span class="c1"># To solve the basis we need a simplex solver</span>
                <span class="c1">#  which does not support a time limit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="n">ClockTimeLimit</span></div></div>

<span class="k">if</span> <span class="n">SCIPAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MOSAICSCIPSolver</span><span class="p">(</span><span class="n">MOSAICMILPSolver</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A dummy implementation of the MILP scheduler if SCIP is not available.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: SCIP not installed. This will not work.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="MOSAICSCIPSolver"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver">[docs]</a>    <span class="k">class</span> <span class="nc">MOSAICSCIPSolver</span><span class="p">(</span><span class="n">MOSAICMILPSolver</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An implementation of the MILP scheduler that uses the SCIP solver.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICSCIPSolver.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.solverSpecificInit">[docs]</a>        <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># # Create the SCIP problem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span> <span class="o">=</span> <span class="n">scip</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;ti-milp&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">hideOutput</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># No aborter for now</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MOSAICSCIPSolver.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.setUp">[docs]</a>        <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="c1"># This used to be a part of a larger function.</span>
            <span class="c1"># By redefining these variables as local, we save a lot of typing</span>
            <span class="c1">#  and possible errors.</span>
            <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
            <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
            <span class="n">CommBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span>
            <span class="n">LinkLatency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Latency</span>
            <span class="c1"># Options = self.Options</span>

            <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c1"># Set up cost function</span>
            <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">CostFunction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                                <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

            <span class="c1"># We create variables</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">X</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">X_cost</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">vtype</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span>
                        <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span><span class="o">*</span><span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">])</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">])</span>
            <span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">ix</span>

            <span class="n">B</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">B_cost</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">B_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">B_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                                <span class="n">vtype</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
                                <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">ub</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">B_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">b_vars_len</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">x_vars_len</span>

            <span class="n">communication_cost_optional_tasks</span> <span class="o">=</span> <span class="mf">1e-8</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">C_cost</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                                    <span class="n">vtype</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>
                                    <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">ub</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;C[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">mm</span><span class="p">)</span>
                                <span class="p">)</span>
                                <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> \
                                    <span class="p">(</span><span class="n">communication_cost_optional_tasks</span><span class="p">)</span>
                                <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">b_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

            <span class="c1"># We set the objective</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span>
                <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">B_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;minimize&quot;</span><span class="p">)</span>

            <span class="c1"># Constraints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done (1b)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span><span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
                        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done once&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span><span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Data Transmission (1c)&quot;</span><span class="p">)</span>
            <span class="c1"># DCConstraintsList = []</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                            <span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span>
                            <span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                            <span class="o">+</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="o">-</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span>
                                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="o">&gt;=</span> <span class="mf">0.</span>
                        <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Multiplexed bandwidth (1d)&quot;</span><span class="p">)</span>
            <span class="c1"># MPConstraintsList = []</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span>
                                                 <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Resource availability</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability (1e)&quot;</span><span class="p">)</span>
            <span class="c1"># RAConstraintList = []</span>
            <span class="c1"># MaxAgentLoad = []</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                    <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">LinkComputationalLoadIn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span>
                    <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">LinkComputationalLoadOut</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                                  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="o">&lt;=</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">MaxComputationLoad</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Latency (1g)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">mm</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                        <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">LinkLatency</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsDataSize</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsBandwidth</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommBandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                        <span class="p">)</span>
                        <span class="o">&lt;=</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">MaxLatency</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Setup time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">B</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">x_vars_len</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_vars_len</span> <span class="o">=</span> <span class="n">b_vars_len</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">comm_vars_length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICSCIPSolver.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.solve">[docs]</a>        <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
            <span class="n">SolveStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="s1">&#39;limits/gap&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="s1">&#39;limits/time&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s1">&#39;Solution status:                   </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;infeasible&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getObjVal</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s1">&#39;Optimal value:                     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SolveStartTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solve time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span><span class="p">))</span>

            <span class="c1"># This is post-processing and should probably be moved to a different function so it can be called on an existing solution.</span>
            <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># This is a ugly hack. Sometimes SCIP will return weird fractional solutions even if we require integral ones. Here, we round.</span>
            <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getVal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                        <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                    <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">:</span> <span class="n">TaskAgent</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">}</span>

            <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">RequiringTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommNetwork</span><span class="o">.</span><span class="n">Bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getVal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getVal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">mm</span><span class="p">])])</span>

            <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Total time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span>
            <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Cplex problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;infeasible&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICSCIPSolver.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.schedule">[docs]</a>        <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># Override to implement time limit</span>
            <span class="n">startSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
            <span class="n">endSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSetupTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Setup time (s): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSetupTime</span><span class="p">))</span>
            <span class="c1"># Set clock time limit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">overallTimeLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s2">&quot;Overall time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overallTimeLimit</span><span class="p">))</span>
                <span class="n">solverTimeLimit</span> <span class="o">=</span> <span class="n">overallTimeLimit</span> <span class="o">-</span> <span class="n">endSetupTime</span>
                <span class="k">if</span> <span class="n">solverTimeLimit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                    <span class="s2">&quot;Setting solver time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solverTimeLimit</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="s1">&#39;limits/time&#39;</span><span class="p">,</span> <span class="n">solverTimeLimit</span><span class="p">)</span>
            <span class="n">startSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
            <span class="n">endSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSolveTime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solution time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">endSolveTime</span> <span class="o">+</span> <span class="n">endSetupTime</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span><span class="p">)</span></div>

<div class="viewcode-block" id="MOSAICSCIPSolver.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.getSolverState">[docs]</a>        <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Solver not called&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICSCIPSolver.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.getProblem">[docs]</a>        <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span></div>

        <span class="c1"># def writeSolution(self, filename=&#39;MIPstarts&#39;):</span>
        <span class="c1">#     # TODO</span>
        <span class="c1">#     self.cpx.parameters.output.writelevel.set(4)</span>
        <span class="c1">#     self.cpx.MIP_starts.write(filename + &#39;.mps&#39;)</span>
        <span class="c1">#     self.cpx.solution.write(filename + &#39;.sol&#39;)</span>

<div class="viewcode-block" id="MOSAICSCIPSolver.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.setTimeLimits">[docs]</a>        <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">DetTicksLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: deterministic ticks limit ignored by SCIP&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ClockTimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="n">ClockTimeLimit</span></div>

<div class="viewcode-block" id="MOSAICSCIPSolver.setSolverParameters"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.ti_milp.MOSAICTISolver.MOSAICSCIPSolver.setSolverParameters">[docs]</a>        <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">Properties</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Properties</span><span class="p">[</span><span class="n">param</span><span class="p">])</span></div></div>


<span class="k">def</span> <span class="nf">flipNestedDictionary</span><span class="p">(</span><span class="n">_dictionary</span><span class="p">):</span>
    <span class="c1"># A utility function to flip the keys of a dictionary. No error handling is deliberate:</span>
    <span class="c1"># this should only take as inputs dicts where all entries have the same (sub)keys.</span>
    <span class="n">newDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">keys1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys1</span><span class="p">):</span>
        <span class="n">keys2</span> <span class="o">=</span> <span class="n">_dictionary</span><span class="p">[</span><span class="n">keys1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">keyA</span> <span class="ow">in</span> <span class="n">keys2</span><span class="p">:</span>
            <span class="n">newDict</span><span class="p">[</span><span class="n">keyA</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">keyB</span> <span class="ow">in</span> <span class="n">keys1</span><span class="p">:</span>
                <span class="n">newDict</span><span class="p">[</span><span class="n">keyA</span><span class="p">][</span><span class="n">keyB</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dictionary</span><span class="p">[</span><span class="n">keyB</span><span class="p">][</span><span class="n">keyA</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">newDict</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, California Institute of Technology (&#34;Caltech&#34;)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>