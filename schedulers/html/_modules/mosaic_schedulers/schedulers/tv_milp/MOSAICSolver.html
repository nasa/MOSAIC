

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mosaic_schedulers.schedulers.tv_milp.MOSAICSolver &mdash; MOSAIC schedulers 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> MOSAIC schedulers
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Installation.html">1. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Scheduling.html">2. Time-varying scheduling algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Allocation.html">3. Task allocation algorithm for robotic networks with periodic connectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Examples.html">4. Usage Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API.html">5. API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../class_documentation.html">6. Modules documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">MOSAIC schedulers</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>mosaic_schedulers.schedulers.tv_milp.MOSAICSolver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for mosaic_schedulers.schedulers.tv_milp.MOSAICSolver</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module that implements the MOSAIC MILP scheduling algorithm.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> Copyright 2019 by California Institute of Technology.  ALL RIGHTS RESERVED.</span>
<span class="sd"> United  States  Government  sponsorship  acknowledged.   Any commercial use</span>
<span class="sd"> must   be  negotiated  with  the  Office  of  Technology  Transfer  at  the</span>
<span class="sd"> California Institute of Technology.</span>
<span class="sd"> </span>
<span class="sd"> This software may be subject to  U.S. export control laws  and regulations.</span>
<span class="sd"> By accepting this document,  the user agrees to comply  with all applicable</span>
<span class="sd"> U.S. export laws and regulations.  User  has the responsibility  to  obtain</span>
<span class="sd"> export  licenses,  or  other  export  authority  as may be required  before</span>
<span class="sd"> exporting  such  information  to  foreign  countries or providing access to</span>
<span class="sd"> foreign persons.</span>
<span class="sd"> </span>
<span class="sd"> This  software  is a copy  and  may not be current.  The latest  version is</span>
<span class="sd"> maintained by and may be obtained from the Mobility  and  Robotics  Sytstem</span>
<span class="sd"> Section (347) at the Jet  Propulsion  Laboratory.   Suggestions and patches</span>
<span class="sd"> are welcome and should be sent to the software&#39;s maintainer.</span>
<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># pylint:disable=E1101</span>
<span class="kn">import</span> <span class="nn">pulp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cplex</span>  <span class="c1"># This will be problematic on ARM</span>
    <span class="n">CPLEXAvailable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">CPLEXAvailable</span> <span class="o">=</span> <span class="kc">False</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Install pyglpk by bradforboyle. Will not work with Python-GLPK.</span>
    <span class="kn">import</span> <span class="nn">glpk</span>
    <span class="n">GLPKAvailable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">GLPKAvailable</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyscipopt</span> <span class="k">as</span> <span class="nn">scip</span>
    <span class="n">SCIPAvailable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">SCIPAvailable</span> <span class="o">=</span> <span class="kc">False</span>
<span class="kn">from</span> <span class="nn">mosaic_schedulers.common.utilities.contact_plan_handler</span> <span class="kn">import</span> <span class="n">compute_time_varying_bandwidth</span>
<span class="kn">from</span> <span class="nn">mosaic_schedulers.common.utilities.contact_plan_handler</span> <span class="kn">import</span> <span class="n">compute_time_invariant_bandwidth_legacy</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>


<div class="viewcode-block" id="MILPTasks"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MILPTasks">[docs]</a><span class="k">class</span> <span class="nc">MILPTasks</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class containing a representation of the tasks for the MILP scheduler.</span>
<span class="sd">    </span>
<span class="sd">    :param OptionalTasks: a dict with Tasks as keys. OptionalTasks[Task] is True if</span>
<span class="sd">                          Task is optional and False otherwise.</span>
<span class="sd">    :type OptionalTasks: dict</span>
<span class="sd">    :param TaskReward: a dict with Tasks as keys. TaskReward[Task] is the reward</span>
<span class="sd">                       obtained for completing Task, a float.</span>
<span class="sd">    :type OptionalTasks: dict</span>
<span class="sd">    :param ProductsSize: a dict with Tasks as keys. PS[Task] is the size of the</span>
<span class="sd">                         products of Task (in storage units), a float.</span>
<span class="sd">    :type ProductsSize: dict</span>
<span class="sd">    :param DependencyList: a dict with Tasks as keys. DL[Task] expresses the</span>
<span class="sd">                           pre-requisites  for each Task is conjunctive normal form. That is,</span>
<span class="sd">                           DependencyList[Task] is a list. Each entry of the List contains a</span>
<span class="sd">                           number of predecessor Tasks.</span>
<span class="sd">                           For each entry in DependencyList[Task][i], at least one task must</span>
<span class="sd">                           be performed.</span>
<span class="sd">    :type DependencyList: dict</span>
<span class="sd">    :param OptionalTasks: a list of lists. IT[j] is a list of  tasks that are incompatible</span>
<span class="sd">                          with each other (that is, only one can be executed).</span>
<span class="sd">    :type OptionalTasks: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OptionalTasks</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">TaskReward</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">ProductsSize</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">DependencyList</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">IncompatibleTasks</span><span class="o">=</span><span class="p">{},</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OptionalTasks</span> <span class="o">=</span> <span class="n">OptionalTasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskReward</span> <span class="o">=</span> <span class="n">TaskReward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ProductsSize</span> <span class="o">=</span> <span class="n">ProductsSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DependencyList</span> <span class="o">=</span> <span class="n">DependencyList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IncompatibleTasks</span> <span class="o">=</span> <span class="n">IncompatibleTasks</span>

        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">TaskReward</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">ProductsSize</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>


<div class="viewcode-block" id="MILPAgentCapabilities"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MILPAgentCapabilities">[docs]</a><span class="k">class</span> <span class="nc">MILPAgentCapabilities</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class containing a representation of the agent capabilities for the</span>
<span class="sd">    MILP scheduler.</span>
<span class="sd">    </span>
<span class="sd">    :param ComputationTime: a dictionary with keys Task, Agent. The value of</span>
<span class="sd">      CT[Task][Agent] is the time (in time steps) required for Agent to</span>
<span class="sd">      complete Tasks, an int.</span>
<span class="sd">    :type ComputationTime: dict</span>
<span class="sd">    :param ComputationLoad: a dictionary with keys Task, Agent. The value of</span>
<span class="sd">      CT[Task][Agent] is the fraction of Agent&#39;s computational resources</span>
<span class="sd">      required to complete Task, a float between 0 and 1.</span>
<span class="sd">    :type ComputationLoad: dict</span>
<span class="sd">    :param  InitialInformation: a dictionary with keys Task, Agent. II[Task][Agent]</span>
<span class="sd">      is a Bool. It is true iff Agent knows the output of Task at time t=0.</span>
<span class="sd">      This can be helpful to specify that only one agent can do a given task</span>
<span class="sd">    :type InitialInformation: dict</span>
<span class="sd">    :param EnergyCost: a dictionary with keys Task, Agent. EnergyCost[T][A] is the</span>
<span class="sd">      energy cost when agent A computes task T.</span>
<span class="sd">    :type EnergyCost: bool</span>
<span class="sd">    :param CommEnergyCost: a dictionary witk keys Time, Sender, Receiver. CET[t][i][j]</span>
<span class="sd">      is the energy cost to send one bit of information from i to j at time t.</span>
<span class="sd">      The actual energy cost is computed as CET[t][i][j]\*Bandwidth[t][i][j]\*</span>
<span class="sd">      \*sum_m C[i][j][m][t]</span>
<span class="sd">    :type CommEnergyCost: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ComputationTime</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">ComputationLoad</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">InitialInformation</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">EnergyCost</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">CommEnergyCost</span><span class="o">=</span><span class="p">{}</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ComputationTime</span> <span class="o">=</span> <span class="n">ComputationTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ComputationLoad</span> <span class="o">=</span> <span class="n">ComputationLoad</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InitialInformation</span> <span class="o">=</span> <span class="n">InitialInformation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnergyCost</span> <span class="o">=</span> <span class="n">EnergyCost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span> <span class="o">=</span> <span class="n">CommEnergyCost</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">EnergyCost</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ComputationTime</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">Agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Agents</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></div>


<div class="viewcode-block" id="CommunicationNetwork"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.CommunicationNetwork">[docs]</a><span class="k">class</span> <span class="nc">CommunicationNetwork</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; A class containing a representation of the communication network.</span>
<span class="sd">    </span>
<span class="sd">    :param CommWindowsBandwidth: a collection of communication windows.</span>
<span class="sd">        CommWindows is a dictionary with keys [0...Thor-1], [Agent], [Agent].</span>
<span class="sd">        CommWindows[Time][Agent1][Agent2] is the bandwidth available</span>
<span class="sd">        to communicate between Agent1 and Agent2 at Time (in bits per</span>
<span class="sd">        unit time).</span>
<span class="sd">    :type CommWindowsBandwidth: dict</span>
<span class="sd">    :param  CommEnergyCost: a dictionary witk keys Time, Sender, Receiver.</span>
<span class="sd">        CET[t][i][j] is the energy cost to send one bit of information from</span>
<span class="sd">        i to j at time t. The actual energy cost is computed as</span>
<span class="sd">        CET[t][i][j]*Bandwidth[t][i][j]*sum_m C[i][j][m][t]</span>
<span class="sd">    :type CommEnergyCost: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CommWindowsBandwidth</span><span class="o">=</span><span class="p">{},</span> <span class="n">CommEnergyCost</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span> <span class="o">=</span> <span class="n">CommWindowsBandwidth</span>
        <span class="k">if</span> <span class="n">CommEnergyCost</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">CommEnergyCost</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">CommWindowsBandwidth</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span> <span class="o">=</span> <span class="n">CommEnergyCost</span></div>


<div class="viewcode-block" id="JSONSolver"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.JSONSolver">[docs]</a><span class="k">class</span> <span class="nc">JSONSolver</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main interface to solve MOSAIC scheduling problems</span>

<span class="sd">    :param JSONProblemDescription: a JSON description of the problem. See the :doc:`API` for a detailed description. Defaults to &#39;&#39;</span>
<span class="sd">    :type JSONProblemDescription: str, optional</span>
<span class="sd">    :param solver: the solver to use. Should be &#39;GLPK&#39;, &#39;CPLEX&#39;, &#39;PuLP&#39; or &#39;SCIP&#39;, defaults to &#39;CPLEX&#39;</span>
<span class="sd">    :type solver: str, optional</span>
<span class="sd">    :param Verbose: whether to print status and debug messages. Defaults to False</span>
<span class="sd">    :type Verbose: bool, optional</span>
<span class="sd">    :param TimeLimit: a time limit after which to stop the optimizer. Defaults to None (no time limit). Note that certain solvers (GLPK) </span>
<span class="sd">                      may not honor the time limit.</span>
<span class="sd">    :type TimeLimit: float, optional</span>
<span class="sd">    :raises ValueError: if the JSONProblemDescription is not valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">JSONProblemDescription</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;CPLEX&#39;</span><span class="p">,</span>
                 <span class="n">Verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">TimeLimit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">JSONInput</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">JSONProblemDescription</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">solver</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GLPK&#39;</span><span class="p">,</span> <span class="s1">&#39;CPLEX&#39;</span><span class="p">,</span> <span class="s1">&#39;PuLP&#39;</span><span class="p">,</span> <span class="s1">&#39;SCIP&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">CPLEXAvailable</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: invalid solver. Defaulting to CPLEX&quot;</span><span class="p">)</span>
                <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;CPLEX&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: invalid solver. Defaulting to GLPK&quot;</span><span class="p">)</span>
                <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;GLPK&quot;</span>
        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;CPLEX&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">CPLEXAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: CPLEX not available. Switching to GLPK&quot;</span><span class="p">)</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;GLPK&quot;</span>

        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;SCIP&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">SCIPAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: SCIP not available. Switching to GLPK&quot;</span><span class="p">)</span>
            <span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;GLPK&quot;</span>

        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;GLPK&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">GLPKAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: GLPK not available. Aborting.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Timing</span>
        <span class="n">Thor_s</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="s2">&quot;Thor&quot;</span><span class="p">]</span>
        <span class="n">TimeStep</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="s2">&quot;TimeStep&quot;</span><span class="p">]</span>
        <span class="n">Thor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Thor_s</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">TimeStep</span><span class="p">))</span>

        <span class="c1"># Tasks</span>
        <span class="n">Tasks</span> <span class="o">=</span> <span class="n">MILPTasks</span><span class="p">(</span>
            <span class="n">OptionalTasks</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;OptionalTasks&quot;</span><span class="p">],</span>
            <span class="n">TaskReward</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;TaskReward&quot;</span><span class="p">],</span>
            <span class="n">ProductsSize</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;ProductsSize&quot;</span><span class="p">],</span>
            <span class="n">DependencyList</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;DependencyList&quot;</span><span class="p">],</span>
            <span class="n">IncompatibleTasks</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Tasks&quot;</span><span class="p">][</span><span class="s2">&quot;IncompatibleTasks&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">AllComputationTime</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;ComputationTime&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">task</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">AllComputationTime</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">agent</span><span class="p">,</span> <span class="n">tasktime</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">AllComputationTime</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">agent</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tasktime</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">TimeStep</span><span class="p">)))</span>

        <span class="c1"># Agent capabilities</span>
        <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="n">MILPAgentCapabilities</span><span class="p">(</span>
            <span class="n">ComputationTime</span><span class="o">=</span><span class="n">AllComputationTime</span><span class="p">,</span>
            <span class="n">ComputationLoad</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;ComputationLoad&quot;</span><span class="p">],</span>
            <span class="n">InitialInformation</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;InitialInformation&quot;</span><span class="p">],</span>
            <span class="n">EnergyCost</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;EnergyCost&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Options</span>
        <span class="n">Options</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;Options&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;Packet Comms&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;CostFunction&#39;</span> <span class="ow">in</span> <span class="n">JSONInput</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;CostFunction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="p">[</span><span class="s1">&#39;CostFunction&#39;</span><span class="p">]</span>
        <span class="n">bandwidth_mode</span> <span class="o">=</span> <span class="n">JSONInput</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BandwidthMode&quot;</span><span class="p">,</span> <span class="s1">&#39;time_varying&#39;</span><span class="p">)</span>

        <span class="c1"># Communication bandwidth</span>
        <span class="k">if</span> <span class="n">bandwidth_mode</span> <span class="o">==</span> <span class="s1">&#39;time_varying&#39;</span><span class="p">:</span>
            <span class="n">CommWindows</span><span class="p">,</span> <span class="n">CommEnergyCost</span> <span class="o">=</span> <span class="n">compute_time_varying_bandwidth</span><span class="p">(</span>
                <span class="n">AgentNames</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;MaxComputationLoad&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
                <span class="p">),</span>
                <span class="n">TVBandwidth</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;CommunicationNetwork&quot;</span><span class="p">],</span>
                <span class="n">time_horizon</span><span class="o">=</span><span class="n">Thor_s</span><span class="p">,</span>
                <span class="n">time_step</span><span class="o">=</span><span class="n">TimeStep</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">bandwidth_mode</span> <span class="o">==</span> <span class="s1">&#39;time_invariant&#39;</span><span class="p">:</span>
            <span class="n">CommWindows</span><span class="p">,</span> <span class="n">CommEnergyCost</span> <span class="o">=</span> <span class="n">compute_time_invariant_bandwidth_legacy</span><span class="p">(</span>
                <span class="n">AgentNames</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;AgentCapabilities&quot;</span><span class="p">][</span><span class="s2">&quot;MaxComputationLoad&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span>
                <span class="p">),</span>
                <span class="n">TVBandwidth</span><span class="o">=</span><span class="n">JSONInput</span><span class="p">[</span><span class="s2">&quot;CommunicationNetwork&quot;</span><span class="p">],</span>
                <span class="n">time_horizon</span><span class="o">=</span><span class="n">Thor_s</span><span class="p">,</span>
                <span class="n">time_step</span><span class="o">=</span><span class="n">TimeStep</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Bandwidth mode </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> not recognized!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bandwidth_mode</span><span class="p">))</span>
        <span class="n">CommNetwork</span> <span class="o">=</span> <span class="n">CommunicationNetwork</span><span class="p">(</span>
            <span class="n">CommWindowsBandwidth</span><span class="o">=</span><span class="n">CommWindows</span><span class="p">,</span>
            <span class="n">CommEnergyCost</span><span class="o">=</span><span class="n">CommEnergyCost</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;CPLEX&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICCPLEXScheduler</span><span class="p">(</span>
                <span class="n">Thor</span><span class="p">,</span>
                <span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommNetwork</span><span class="p">,</span>
                <span class="n">TimeStep</span><span class="p">,</span>
                <span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">setTimeLimits</span><span class="p">(</span><span class="n">ClockTimeLimit</span><span class="o">=</span><span class="n">TimeLimit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;GLPK&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICGLPKScheduler</span><span class="p">(</span>
                <span class="n">Thor</span><span class="p">,</span>
                <span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommNetwork</span><span class="p">,</span>
                <span class="n">TimeStep</span><span class="p">,</span>
                <span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">setTimeLimits</span><span class="p">(</span><span class="n">ClockTimeLimit</span><span class="o">=</span><span class="n">TimeLimit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;PuLP&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICPULPScheduler</span><span class="p">(</span>
                <span class="n">Thor</span><span class="p">,</span>
                <span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommNetwork</span><span class="p">,</span>
                <span class="n">TimeStep</span><span class="p">,</span>
                <span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s2">&quot;SCIP&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span> <span class="o">=</span> <span class="n">MOSAICSCIPScheduler</span><span class="p">(</span>
                <span class="n">Thor</span><span class="p">,</span>
                <span class="n">AgentCapabilities</span><span class="p">,</span>
                <span class="n">Tasks</span><span class="p">,</span>
                <span class="n">CommNetwork</span><span class="p">,</span>
                <span class="n">TimeStep</span><span class="p">,</span>
                <span class="n">Options</span><span class="p">,</span>
                <span class="n">Verbose</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">setTimeLimits</span><span class="p">(</span><span class="n">ClockTimeLimit</span><span class="o">=</span><span class="n">TimeLimit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">schedule</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Scheduler</span><span class="o">.</span><span class="n">formatOutput</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span></div>


<div class="viewcode-block" id="MOSAICMILPScheduler"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler">[docs]</a><span class="k">class</span> <span class="nc">MOSAICMILPScheduler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. warning ::</span>
<span class="sd">       </span>
<span class="sd">       For an easier-to-use and more consistent interface, you most likely want to call</span>
<span class="sd">       :class:`JSONSolver` instead of this class and its subclasses.</span>

<span class="sd">    Abstract implementation of a MILP solution to the MOSAIC scheduler.</span>
<span class="sd">    Subclassed by the solvers :class:`MOSAICCPLEXScheduler`, :class:`MOSAICSCIPScheduler`,</span>
<span class="sd">    :class:`MOSAICPULPScheduler`, and :class:`MOSAICGLPKScheduler`.</span>
<span class="sd">    You probably want to call :class:`JSONSolver` instead of these.</span>

<span class="sd">    Usage:</span>
<span class="sd">    </span>
<span class="sd">    * :func:`schedule`: creates the optimization problem, solves it, and returns a JSON representation of the solution (in non-standard format)</span>
<span class="sd">    </span>
<span class="sd">    * :func:`getOptimizationTerminator`: returns a function that can be called to stop the optimization process asynchronously</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    For a detailed description of the MILP problem we solve, see the IJRR</span>
<span class="sd">    manuscript.</span>

<span class="sd">    :param Thor: the time horizon of the optimization, an int.</span>
<span class="sd">    :type Thor: int</span>
<span class="sd">    :param AgentCapabilities: detailing what the agents can do</span>
<span class="sd">    :type AgentCapabilities: MOSAICSolver.MILPAgentCapabilities</span>
<span class="sd">    :param Tasks: detailing the tasks that must be achieved</span>
<span class="sd">    :type Tasks: MOSAICSolver.MILPTasks</span>
<span class="sd">    :param CommunicationNetwork: detailing the communication network availability</span>
<span class="sd">    :type CommunicationNetwork: MOSAICSolver.CommunicationNetwork</span>
<span class="sd">    :param TimeStep: The duration (in seconds) of a discrete time step.</span>
<span class="sd">    :type TimeStep: float</span>
<span class="sd">    :param Options: additional solver-specific options, defaults to {}</span>
<span class="sd">    :type Options: dict, optional</span>
<span class="sd">    :param Verbose: if True, prints status and debug messages. Defaults to False</span>
<span class="sd">    :type Verbose: bool, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">Thor</span><span class="p">,</span>
                 <span class="n">AgentCapabilities</span><span class="p">,</span>
                 <span class="n">Tasks</span><span class="p">,</span>
                 <span class="n">CommunicationNetwork</span><span class="p">,</span>
                 <span class="n">TimeStep</span><span class="p">,</span>
                 <span class="n">Options</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">Verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span> <span class="o">=</span> <span class="n">Thor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="n">AgentCapabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span> <span class="o">=</span> <span class="n">Tasks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span> <span class="o">=</span> <span class="n">CommunicationNetwork</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span> <span class="o">=</span> <span class="n">CommunicationNetwork</span><span class="o">.</span><span class="n">CommEnergyCost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Options</span> <span class="o">=</span> <span class="n">Options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TimeStep</span> <span class="o">=</span> <span class="n">TimeStep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="o">=</span> <span class="n">Verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">JSONIsFormed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solverSpecificInit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MOSAICMILPScheduler.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.solverSpecificInit">[docs]</a>    <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; A place to define solver-specific initializations in subclasses &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_FindMaxStartCommTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Agent1</span><span class="p">,</span> <span class="n">Agent2</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Helper function to find the earliest time a communication could have started &#39;&#39;&#39;</span>
        <span class="c1"># We look for max tau such that sum_{tt=tau}^{Time-1} CommBandwidth(tt)&gt;=TaskSize.</span>
        <span class="c1"># First we note that sum_{tt=tau}^{Time-1} CommBandwidth(tt) = CumCommBandwidth(Time)-CumCommBandwidth(tau) (note that the definition of CUmCommBandwidth below is &quot;shifted by one&quot; for this reason)</span>
        <span class="c1"># Next, we sweep ts from 0 to Time and check the property. We find the first time that fails the test above and return ts-1. If even t=0 fails the test, well, there is no way to get done by t. So we return None</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Time</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">Time</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">ts</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
                <span class="c1"># Recall that we get the bandwidth from the beginning of ts until the end of T. To put it differently, the delta above is the delta from ts+1 until T</span>
                <span class="n">tstart</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c1"># print(tstart,&#39;is the latest start time for task &#39;,Task ,&#39;to be done by time&#39;, Time, &#39; from agent &#39;,Agent1,&#39; to agent &#39;,Agent2)</span>
                <span class="k">if</span> <span class="n">tstart</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">tstart</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="n">tstart</span>
        <span class="k">return</span> <span class="n">Time</span>

    <span class="k">def</span> <span class="nf">_FindEndCommTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Agent1</span><span class="p">,</span> <span class="n">Agent2</span><span class="p">,</span> <span class="n">Task</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Helper function to find the end time for a given communication &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">ts</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">Time</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">Task</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">ts</span>
        <span class="c1"># If there is no way this is done by the end of the horizon (should probably not happen)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_ComputeCumulativeCommBandwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Helper function to find the total available number of bits that</span>
<span class="sd">        can be transmitted between two agents in a given time interval &#39;&#39;&#39;</span>
        <span class="c1"># Note that this is a _shifted_ cumsum with CCB(0)=0 and CCB(t)=sum_{tau=0}^{t-1} CB(tau).</span>
        <span class="n">TaskNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">AgentNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">TaskNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">Agent1</span> <span class="ow">in</span> <span class="n">AgentNames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">Agent1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">Agent2</span> <span class="ow">in</span> <span class="n">AgentNames</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">Agent1</span> <span class="ow">in</span> <span class="n">AgentNames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">Agent1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">Agent2</span> <span class="ow">in</span> <span class="n">AgentNames</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span>
                                                                                                <span class="mi">1</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CumulativeCommBandwidth</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">Agent1</span><span class="p">][</span><span class="n">Agent2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_verbprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_str</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Helper function to only print if the verbose flag is set&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">formatToJSON</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Calling solver&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># AgentsList = list(self.AgentCapabilities.ComputationLoad[TasksList[0]].keys())</span>
        <span class="n">TaskSchedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskSchedule&#39;</span><span class="p">]</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">]</span>
        <span class="n">ComputationTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span>
        <span class="n">TimeStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeStep</span>
        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span>

        <span class="c1"># Create timeline</span>
        <span class="c1"># Timeline = pd.DataFrame(</span>
        <span class="c1">#     columns=[&#39;Agent&#39;, &#39;Start time&#39;, &#39;Duration&#39;, &#39;Task type&#39;, &#39;Task&#39;])</span>
        <span class="n">Timeline</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Add tasks</span>
        <span class="k">for</span> <span class="n">taskid</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">TaskAgent</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">TaskSchedule</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">_agent</span> <span class="o">=</span> <span class="n">TaskAgent</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span>
                <span class="n">_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">TaskSchedule</span><span class="p">[</span><span class="n">taskid</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">taskid</span><span class="p">][</span><span class="n">_agent</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
                <span class="n">_name</span> <span class="o">=</span> <span class="n">taskid</span>
                <span class="n">Timeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Agent&#39;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span> <span class="s1">&#39;Start time&#39;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span> <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                                 <span class="s1">&#39;Task type&#39;</span><span class="p">:</span> <span class="s1">&#39;Compute&#39;</span><span class="p">,</span> <span class="s1">&#39;Task&#39;</span><span class="p">:</span> <span class="n">_name</span><span class="p">})</span>

        <span class="c1"># Add communication</span>
        <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">CommSchedule</span><span class="p">:</span>
            <span class="n">_agent</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">comm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
            <span class="n">_taskname</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">_receiver</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">comm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">comm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="n">TimeStep</span>

            <span class="n">CommTask</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Transmitter&#39;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                        <span class="s1">&#39;Receiver&#39;</span><span class="p">:</span> <span class="n">_receiver</span><span class="p">,</span> <span class="s1">&#39;Product&#39;</span><span class="p">:</span> <span class="n">_taskname</span><span class="p">}</span>

            <span class="n">Timeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Agent&#39;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span> <span class="s1">&#39;Start time&#39;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span> <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                             <span class="s1">&#39;Task type&#39;</span><span class="p">:</span> <span class="s1">&#39;Communicate&#39;</span><span class="p">,</span> <span class="s1">&#39;Task&#39;</span><span class="p">:</span> <span class="n">CommTask</span><span class="p">})</span>
            <span class="n">Timeline</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Agent&#39;</span><span class="p">:</span> <span class="n">_receiver</span><span class="p">,</span> <span class="s1">&#39;Start time&#39;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span> <span class="s1">&#39;Duration&#39;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                             <span class="s1">&#39;Task type&#39;</span><span class="p">:</span> <span class="s1">&#39;Communicate&#39;</span><span class="p">,</span> <span class="s1">&#39;Task&#39;</span><span class="p">:</span> <span class="n">CommTask</span><span class="p">})</span>

        <span class="c1"># Timeline.sort_values(by=&#39;Start time&#39;, inplace=True)</span>
        <span class="c1"># Timeline.reset_index(inplace=True, drop=True)</span>
        <span class="n">Timeline</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Start time&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">Timeline</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">JSONIsFormed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span>

    <span class="k">def</span> <span class="nf">_formatToBenchmarkIO</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Formats the problem in the format defined in the :doc:`API`&quot;&quot;&quot;</span>
        <span class="n">tasks_output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&#39;&#39;&#39; Formats the scheduler output to JSON &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Calling solver&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># AgentsList = list(self.AgentCapabilities.ComputationLoad[TasksList[0]].keys())</span>
        <span class="n">TaskSchedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskSchedule&#39;</span><span class="p">]</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">]</span>
        <span class="n">ComputationTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span>
        <span class="n">TimeStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeStep</span>
        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span>

        <span class="k">for</span> <span class="n">taskid</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">TaskAgent</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">TaskSchedule</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">_agent</span> <span class="o">=</span> <span class="n">TaskAgent</span><span class="p">[</span><span class="n">taskid</span><span class="p">]</span>
                <span class="n">_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">TaskSchedule</span><span class="p">[</span><span class="n">taskid</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">taskid</span><span class="p">][</span><span class="n">_agent</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
                <span class="n">_name</span> <span class="o">=</span> <span class="n">taskid</span>
                <span class="n">task_output</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                    <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">_name</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">_name</span><span class="p">,</span>
                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;agent&quot;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="n">tasks_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_output</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">CommSchedule</span><span class="p">:</span>
            <span class="n">_agent</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">comm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
            <span class="n">_taskname</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">_receiver</span> <span class="o">=</span> <span class="n">comm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">comm</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">comm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">TimeStep</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_duration</span> <span class="o">=</span> <span class="n">TimeStep</span>
            <span class="n">task_output_tx</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">_duration</span><span class="p">,</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">_time</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;transfer_data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;transfer_data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;transmitter&quot;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                    <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">_taskname</span><span class="p">,</span>
                    <span class="s2">&quot;agent&quot;</span><span class="p">:</span> <span class="n">_agent</span><span class="p">,</span>
                    <span class="s2">&quot;receiver&quot;</span><span class="p">:</span> <span class="n">_receiver</span><span class="p">,</span>
                    <span class="c1"># TODO</span>
                    <span class="s2">&quot;bandwidth&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">comm</span><span class="p">[</span><span class="mi">3</span><span class="p">]][</span><span class="n">_agent</span><span class="p">][</span><span class="n">_receiver</span><span class="p">],</span>
                <span class="p">},</span>
            <span class="p">}</span>
            <span class="n">tasks_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_output_tx</span><span class="p">)</span>
            <span class="n">task_output_rx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">task_output_tx</span><span class="p">)</span>
            <span class="n">task_output_rx</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_output_rx</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">][</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
            <span class="n">tasks_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_output_rx</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">sort_by_time</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
        <span class="n">tasks_output</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">sort_by_time</span><span class="p">)</span>
        <span class="n">out_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tasks&quot;</span><span class="p">:</span> <span class="n">tasks_output</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">out_dict</span><span class="p">)</span>

<div class="viewcode-block" id="MOSAICMILPScheduler.formatOutput"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.formatOutput">[docs]</a>    <span class="k">def</span> <span class="nf">formatOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats output.</span>

<span class="sd">        :param version: V1: just a pass-through for formatToJSON.</span>
<span class="sd">                        V2 (default): the standard I/O format defined in the :doc:`API`. </span>
<span class="sd">        :type version: int, optional</span>
<span class="sd">        :return: JSON output</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">JSONIsFormed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatToJSON</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span>
        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatToBenchmarkIO</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.getRawOutput"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.getRawOutput">[docs]</a>    <span class="k">def</span> <span class="nf">getRawOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the raw problem output from the solver &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set up the problem, solve it, and return the solution (in an older, non-JSON I/O format) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatToJSON</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.setTimeLimits">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets a time limit for the overall process. May be ignored by certain</span>
<span class="sd">        solvers.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.setSolverParameters"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.setSolverParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Passes a dictionary of parameters to the solver</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; The problem is set up here. At this time, the entire setup is repeated for each solver. &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; The problem is solved here. &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.setMIPStart"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.setMIPStart">[docs]</a>    <span class="k">def</span> <span class="nf">setMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MIPStart</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Certain solvers allow the MIP to be &quot;seeded&quot; with a MIP start. &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.getSolverState">[docs]</a>    <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; This function allows extracting the internal MIP state for warm-starting. &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.getProblem">[docs]</a>    <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the solver-specific problem object &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="MOSAICMILPScheduler.getOptimizationTerminator"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICMILPScheduler.getOptimizationTerminator">[docs]</a>    <span class="k">def</span> <span class="nf">getOptimizationTerminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets an object that can be called to stop the optimization process &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="MOSAICCPLEXScheduler"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler">[docs]</a><span class="k">class</span> <span class="nc">MOSAICCPLEXScheduler</span><span class="p">(</span><span class="n">MOSAICMILPScheduler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An implementation of the MILP scheduler that uses the IBM ILOG CPLEX solver.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.solverSpecificInit">[docs]</a>    <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">CPLEXAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CPLEX not available. This will not work&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Create the CPLEX problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span> <span class="o">=</span> <span class="n">cplex</span><span class="o">.</span><span class="n">Cplex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">objective</span><span class="o">.</span><span class="n">set_sense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">objective</span><span class="o">.</span><span class="n">sense</span><span class="o">.</span><span class="n">maximize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">use_aborter</span><span class="p">(</span><span class="n">cplex</span><span class="o">.</span><span class="n">Aborter</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># This used to be a part of a larger function.</span>
        <span class="c1"># By redefining these variables as local, we save a lot of typing</span>
        <span class="c1">#  and possible errors.</span>
        <span class="n">Thor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span>
        <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
        <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
        <span class="n">CommWindowsBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span>
        <span class="n">Options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span>

        <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                            <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">TasksList</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">info_weight</span> <span class="o">=</span> <span class="mf">0.001</span>

        <span class="c1"># We find things</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">X</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">X_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                        <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">X_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                        <span class="n">X_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="o">-</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">X_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;X[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
        <span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">ix</span>

        <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">D_UB</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">D_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                    <span class="n">D_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;D[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">D_UB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">InitialInformation</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">D_UB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">d_vars_len</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">x_vars_len</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">C_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">C_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">C_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                            <span class="n">C_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">info_weight</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="mf">0.</span>
                                <span class="n">end_comm_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span>
                                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">end_comm_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">end_comm_time</span> <span class="o">=</span> <span class="n">Thor</span><span class="o">+</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">transmission_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">end_comm_time</span><span class="p">):</span>
                                    <span class="n">temp_energy_cost</span> <span class="o">+=</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">C_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">temp_energy_cost</span><span class="p">)</span>
                            <span class="n">C_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">d_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

        <span class="n">I</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">I_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
            <span class="n">I</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
            <span class="n">I_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;I[</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">idle_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">comm_vars_length</span> <span class="o">-</span> <span class="n">d_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

        <span class="n">X_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">X_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">C_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">C_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">C_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># We create the variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">X_cost</span><span class="p">,</span>
            <span class="n">lb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vars_len</span><span class="p">,</span>
            <span class="n">ub</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vars_len</span><span class="p">,</span>
            <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_vars_len</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">X_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_vars_len</span><span class="p">,</span>
            <span class="n">lb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_vars_len</span><span class="p">,</span>
            <span class="n">ub</span><span class="o">=</span><span class="n">D_UB</span><span class="p">,</span>
            <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_vars_len</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">D_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">C_cost</span><span class="p">,</span>
            <span class="n">lb</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">comm_vars_length</span><span class="p">,</span>
            <span class="n">ub</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">comm_vars_length</span><span class="p">,</span>
            <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">comm_vars_length</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">C_name</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]]))],</span>
                                                                   <span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]]))])</span>
                                                  <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">],</span>
                                        <span class="n">senses</span><span class="o">=</span><span class="p">[</span>
                                            <span class="s1">&#39;G&#39;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">],</span>
                                        <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done once&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]]))],</span>
                                                                   <span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]]))])</span>
                                                  <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">],</span>
                                        <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">],</span>
                                        <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Incompatible tasks&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">BadTask</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">BadTask</span> <span class="ow">in</span> <span class="n">BadPairing</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">BadTask</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span>
                                                                   <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">BadTask</span> <span class="ow">in</span> <span class="n">BadPairing</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">BadTask</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
                                                  <span class="k">for</span> <span class="n">BadPairing</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">IncompatibleTasks</span><span class="p">],</span>
                                        <span class="n">senses</span><span class="o">=</span><span class="p">[</span>
                                            <span class="s1">&#39;L&#39;</span> <span class="k">for</span> <span class="n">BadPairing</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">IncompatibleTasks</span><span class="p">],</span>
                                        <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">BadPairing</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">IncompatibleTasks</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Task Dependencies&quot;</span><span class="p">)</span>
        <span class="n">TaskDependencyConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">TaskDependencyConstraintList</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="k">for</span> <span class="n">DepTasks</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">DepTasks</span><span class="p">:</span>
                                    <span class="n">TaskDependencyConstraintList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">predecessor</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">DepTasks</span><span class="p">],</span>
                                                                                      <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">DepTasks</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="n">TaskDependencyConstraintList</span><span class="p">,</span>
                                        <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="n">TaskDependencyConstraintList</span><span class="p">),</span>
                                        <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">TaskDependencyConstraintList</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability&quot;</span><span class="p">)</span>
            <span class="n">RAConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="mi">1</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="mi">1</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">RAConstraintList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="n">RAConstraintList</span><span class="p">,</span>
                                            <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">RAConstraintList</span><span class="p">),</span>
                                            <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">RAConstraintList</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: New information acquisition&quot;</span><span class="p">)</span>
            <span class="c1"># New information acquisition</span>
            <span class="n">NIConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span>
                        <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">m</span><span class="p">])])</span>
                                      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                                 <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">NIConstraintList</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="n">NIConstraintList</span><span class="p">,</span>
                                            <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">NIConstraintList</span><span class="p">),</span>
                                            <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">NIConstraintList</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: Resource availability (no packet comms)&quot;</span><span class="p">)</span>
            <span class="c1"># Resource availability</span>
            <span class="n">RAConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="n">MCT_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_to</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                            <span class="n">MCT_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_from</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_from</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_from</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_from</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">RAConstraintList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="n">RAConstraintList</span><span class="p">,</span>
                                            <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">RAConstraintList</span><span class="p">),</span>
                                            <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">RAConstraintList</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: New information acquisition (no packet comms)&quot;</span><span class="p">)</span>
            <span class="n">NIConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># New information acquisition</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span>
                        <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="c1"># This is the maximum time so that we will have received the information by time t+1</span>
                            <span class="n">MCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span>
                                             <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MCT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                                <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                    <span class="n">MCT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                                 <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">NIConstraintList</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="n">NIConstraintList</span><span class="p">,</span>
                                            <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">*</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">NIConstraintList</span><span class="p">),</span>
                                            <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">NIConstraintList</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Knowledge&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">linear_constraints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lin_expr</span><span class="o">=</span><span class="p">[</span><span class="n">cplex</span><span class="o">.</span><span class="n">SparsePair</span><span class="p">([</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">senses</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;L&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                            <span class="n">Thor</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">],</span>
                                        <span class="n">rhs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Setup time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">x_vars_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span> <span class="o">=</span> <span class="n">d_vars_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">comm_vars_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">SolveStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mip</span><span class="o">.</span><span class="n">tolerances</span><span class="o">.</span><span class="n">mipgap</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">set_log_stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">set_warning_stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">set_results_stream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solution status:                   </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">is_primal_feasible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_objective_value</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s1">&#39;Optimal value:                     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
            <span class="c1"># Solution in MIP Start format</span>
            <span class="n">varNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>
            <span class="n">varValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">varNames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CPLEXSol</span> <span class="o">=</span> <span class="p">[</span><span class="n">varNames</span><span class="p">,</span> <span class="n">varValues</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get_num</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SolveStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solve time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span><span class="p">))</span>

        <span class="c1"># This is post-processing and should probably be moved to a different function so it can be called on an existing solution.</span>
        <span class="n">TaskSchedule</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># This is a ugly hack. Sometimes CPLEX will return weird fractional solutions even if we require integral ones. Here, we round.</span>
        <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
            <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                        <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                        <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TaskSchedule&#39;</span><span class="p">:</span> <span class="n">TaskSchedule</span><span class="p">,</span>
                          <span class="s1">&#39;TaskAgent&#39;</span><span class="p">:</span> <span class="n">TaskAgent</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">}</span>

        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">EndCommTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">EndCommTime</span><span class="p">])</span>

        <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span><span class="p">]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span><span class="p">:]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status_string</span><span class="p">()</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Total time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Cplex problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">is_primal_feasible</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">getMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CPLEXSol</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.setMIPStart"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.setMIPStart">[docs]</a>    <span class="k">def</span> <span class="nf">setMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MIPStart</span><span class="p">,</span> <span class="n">effort_level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">MIP_starts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MIPStart</span><span class="p">,</span> <span class="n">effort_level</span><span class="p">)</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Override to implement time limit</span>
        <span class="n">startSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">endSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSetupTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Setup time (s): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSetupTime</span><span class="p">))</span>
        <span class="c1"># Set clock time limit</span>
        <span class="n">overallTimeLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timelimit</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overallTimeLimit</span><span class="p">))</span>
        <span class="n">solverTimeLimit</span> <span class="o">=</span> <span class="n">overallTimeLimit</span> <span class="o">-</span> <span class="n">endSetupTime</span>
        <span class="k">if</span> <span class="n">solverTimeLimit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
            <span class="s2">&quot;Setting solver time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solverTimeLimit</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timelimit</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">solverTimeLimit</span><span class="p">)</span>
        <span class="n">startSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="n">endSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSolveTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solution time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span> <span class="o">+</span> <span class="n">endSetupTime</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatToJSON</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.getSolverState">[docs]</a>    <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Solver not called&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.getProblem">[docs]</a>    <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span></div>

    <span class="k">def</span> <span class="nf">writeSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;MIPstarts&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">writelevel</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">MIP_starts</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.mps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">solution</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.sol&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.getOptimizationTerminator"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.getOptimizationTerminator">[docs]</a>    <span class="k">def</span> <span class="nf">getOptimizationTerminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Gets an object that can be called to stop the optimization process.</span>
<span class="sd">            To actually terminate the problem, call the method abort() of the</span>
<span class="sd">            returned object.</span>
<span class="sd">            &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.setTimeLimits">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">):</span>
        <span class="c1"># Deterministic time limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">dettimelimit</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">DetTicksLimit</span><span class="p">)</span>
        <span class="c1"># clock time limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">timelimit</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ClockTimeLimit</span><span class="p">)</span></div>

<div class="viewcode-block" id="MOSAICCPLEXScheduler.setSolverParameters"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICCPLEXScheduler.setSolverParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">Properties</span><span class="p">:</span>
            <span class="n">propset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">propset</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">propset</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
            <span class="n">propset</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">Properties</span><span class="p">[</span><span class="n">param</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="MOSAICSCIPScheduler"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler">[docs]</a><span class="k">class</span> <span class="nc">MOSAICSCIPScheduler</span><span class="p">(</span><span class="n">MOSAICMILPScheduler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An implementation of the MILP scheduler that uses the SCIP solver.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICSCIPScheduler.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.solverSpecificInit">[docs]</a>    <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">SCIPAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SCIP not available. This will not work&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># # Create the SCIP problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span> <span class="o">=</span> <span class="n">scip</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;tv-milp&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">hideOutput</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># No aborter for now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># This used to be a part of a larger function.</span>
        <span class="c1"># By redefining these variables as local, we save a lot of typing</span>
        <span class="c1">#  and possible errors.</span>
        <span class="n">Thor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span>
        <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
        <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
        <span class="n">CommWindowsBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span>
        <span class="n">Options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span>

        <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                            <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">TasksList</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">info_weight</span> <span class="o">=</span> <span class="mf">0.001</span>

        <span class="c1"># We find things</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">X</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">X_cost</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                            <span class="n">vtype</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;X[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span>
                            <span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        <span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">ix</span>

        <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">D_cost</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">D_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">D_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">D_UB</span> <span class="o">=</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">InitialInformation</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">D_UB</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">vtype</span><span class="o">=</span><span class="s2">&quot;I&quot;</span><span class="p">,</span>  <span class="c1"># If &#39;B&#39; is specified, UBs and LBs are ignored</span>
                        <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">ub</span><span class="o">=</span><span class="n">D_UB</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;D[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">D_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">d_vars_len</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">x_vars_len</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">C_cost</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                                <span class="n">vtype</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;C[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="mf">0.</span>
                                <span class="n">end_comm_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span>
                                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">end_comm_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">end_comm_time</span> <span class="o">=</span> <span class="n">Thor</span><span class="o">+</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">transmission_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">end_comm_time</span><span class="p">):</span>
                                    <span class="n">temp_energy_cost</span> <span class="o">+=</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                                    <span class="c1"># TODO should t be transmission_time here?</span>
                            <span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> \
                                <span class="n">info_weight</span> <span class="o">+</span> \
                                <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">temp_energy_cost</span><span class="p">)</span>
                            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">d_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

        <span class="c1"># Set the objective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span>
            <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">X_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span>
                          <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span>
                          <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                          <span class="p">)</span>
            <span class="o">+</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span>
                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span>
                            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                            <span class="p">),</span>
            <span class="s2">&quot;minimize&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span><span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]])))</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done once&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span><span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]])))</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Incompatible tasks&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">BadPairing</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">IncompatibleTasks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span><span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">BadTask</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">BadTask</span> <span class="ow">in</span> <span class="n">BadPairing</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">BadTask</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                             <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Task Dependencies&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="k">for</span> <span class="n">DepTasks</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">DepTasks</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                                        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">predecessor</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                                                   <span class="k">for</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">DepTasks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                        <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span>
                                      <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                        <span class="o">+</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>
                        <span class="o">+</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>
                        <span class="o">&lt;=</span> <span class="mi">1</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: New information acquisition&quot;</span><span class="p">)</span>
            <span class="c1"># New information acquisition</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                                <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span>
                                <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">m</span><span class="p">])])</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span>
                                <span class="o">-</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                          <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                                <span class="o">&lt;=</span> <span class="mi">0</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                                <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span>
                                <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">m</span><span class="p">])])</span>
                                              <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                                <span class="o">&lt;=</span> <span class="mi">0</span>
                            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: Resource availability (no packet comms)&quot;</span><span class="p">)</span>
            <span class="c1"># Resource availability</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">local_processes</span> <span class="o">=</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span>
                                                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="n">MCT_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_to</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="n">outbound_comms</span> <span class="o">=</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>
                            <span class="n">MCT_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_from</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_from</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">inbound_comms</span> <span class="o">=</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_from</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                        <span class="n">local_processes</span><span class="o">+</span><span class="n">outbound_comms</span><span class="o">+</span><span class="n">inbound_comms</span> <span class="o">&lt;=</span> <span class="mi">1</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: New information acquisition (no packet comms)&quot;</span><span class="p">)</span>
            <span class="c1"># New information acquisition</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">VarsListInboundInfo</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="c1"># This is the maximum time so that we will have received the information by time t+1</span>
                            <span class="n">MCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">VarsListInboundInfo</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                    <span class="n">MCT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">VarsListInboundInfo</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                                            <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                            <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">scip</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">VarsListInboundInfo</span><span class="p">)</span>
                            <span class="o">&lt;=</span> <span class="mf">0.</span>
                        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Knowledge&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addCons</span><span class="p">(</span>
                                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Setup time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">x_vars_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span> <span class="o">=</span> <span class="n">d_vars_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">comm_vars_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">SolveStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="s1">&#39;limits/gap&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="s1">&#39;limits/time&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
            <span class="s1">&#39;Solution status:                   </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;infeasible&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getObjVal</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s1">&#39;Optimal value:                     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SolveStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solve time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span><span class="p">))</span>

        <span class="c1"># This is post-processing and should probably be moved to a different function so it can be called on an existing solution.</span>
        <span class="n">TaskSchedule</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># This is a ugly hack. Sometimes the solver will return weird fractional solutions even if we require integral ones. Here, we round.</span>
        <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
            <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getVal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                        <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                        <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TaskSchedule&#39;</span><span class="p">:</span> <span class="n">TaskSchedule</span><span class="p">,</span>
                          <span class="s1">&#39;TaskAgent&#39;</span><span class="p">:</span> <span class="n">TaskAgent</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">}</span>

        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getVal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">EndCommTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">EndCommTime</span><span class="p">])</span>

        <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Total time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Cplex problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;infeasible&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.setMIPStart"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.setMIPStart">[docs]</a>    <span class="k">def</span> <span class="nf">setMIPStart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MIPStart</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Certain solvers allow the MIP to be &quot;seeded&quot; with a MIP start. &#39;&#39;&#39;</span>
        <span class="c1"># See https://github.com/SCIP-Interfaces/PySCIPOpt/issues/115 for syntax.</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">createSol</span><span class="p">()</span>
        <span class="c1"># MIPStart is a dict containing the name of each variable and the corresponding value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">MIPStart</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setSolVal</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">addSol</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Override to implement time limit</span>
        <span class="n">startSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">endSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSetupTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Setup time (s): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSetupTime</span><span class="p">))</span>
        <span class="c1"># Set clock time limit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">overallTimeLimit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">overallTimeLimit</span><span class="p">))</span>
            <span class="n">solverTimeLimit</span> <span class="o">=</span> <span class="n">overallTimeLimit</span> <span class="o">-</span> <span class="n">endSetupTime</span>
            <span class="k">if</span> <span class="n">solverTimeLimit</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Setting solver time limit: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solverTimeLimit</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="s1">&#39;limits/time&#39;</span><span class="p">,</span> <span class="n">solverTimeLimit</span><span class="p">)</span>
        <span class="n">startSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="n">endSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSolveTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solution time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span> <span class="o">+</span> <span class="n">endSetupTime</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatToJSON</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.getSolverState">[docs]</a>    <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Solver not called&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.getProblem">[docs]</a>    <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.setTimeLimits">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">DetTicksLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: deterministic ticks limit ignored by SCIP&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ClockTimeLimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="n">ClockTimeLimit</span></div>

<div class="viewcode-block" id="MOSAICSCIPScheduler.setSolverParameters"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICSCIPScheduler.setSolverParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">Properties</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">setRealParam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Properties</span><span class="p">[</span><span class="n">param</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="MOSAICPULPScheduler"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICPULPScheduler">[docs]</a><span class="k">class</span> <span class="nc">MOSAICPULPScheduler</span><span class="p">(</span><span class="n">MOSAICMILPScheduler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An implementation of the MILP scheduler that uses the PuLP modeling package.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICPULPScheduler.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICPULPScheduler.solverSpecificInit">[docs]</a>    <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICPULPScheduler.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICPULPScheduler.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Building problem&quot;</span><span class="p">)</span>

        <span class="n">Thor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span>
        <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
        <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
        <span class="n">CommWindowsBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span>
        <span class="n">Options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span>

        <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                            <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">TasksList</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Creating variables&quot;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">AgentsList</span><span class="p">,</span> <span class="n">TasksList</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">))),</span>
                                  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpBinary</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">AgentsList</span><span class="p">,</span> <span class="n">TasksList</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">))),</span>
                                  <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpBinary</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">AgentsList</span><span class="p">,</span> <span class="n">AgentsList</span><span class="p">,</span> <span class="n">TasksList</span><span class="p">,</span>
                                        <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">))),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpBinary</span><span class="p">)</span>

        <span class="c1"># Create the problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Creating problem&quot;</span><span class="p">)</span>
        <span class="n">MILPproblem</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s2">&quot;MOSAIC MILP&quot;</span><span class="p">,</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpMinimize</span><span class="p">)</span>

        <span class="c1"># Cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Creating Cost: task cost&quot;</span><span class="p">)</span>
        <span class="n">OptionalTaskCost</span> <span class="o">=</span> <span class="o">-</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span>
                                         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                                         <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">info_weight</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Information cost&quot;</span><span class="p">)</span>
        <span class="n">InfoDiffusionCost</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span>
            <span class="n">info_weight</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">)</span>
        <span class="c1"># TODO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Energy cost&quot;</span><span class="p">)</span>
        <span class="n">EnergyCostTask</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span>
                                     <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                                     <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                                <span class="n">end_comm_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span>
                                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">end_comm_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">end_comm_time</span> <span class="o">=</span> <span class="n">Thor</span><span class="o">+</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">transmission_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">end_comm_time</span><span class="p">):</span>
                                    <span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

        <span class="n">EnergyCostComm</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">temp_energy_cost</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># /TODO</span>

        <span class="c1"># Note the [0], because Numpy is deeply weird</span>
        <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">OptionalTaskCost</span> <span class="o">+</span> <span class="n">InfoDiffusionCost</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">EnergyCostTask</span><span class="o">+</span><span class="n">EnergyCostComm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done&quot;</span><span class="p">)</span>
        <span class="c1"># Constraints</span>
        <span class="c1"># Getting the job done</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]])))</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> done&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="n">Thor</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Job </span><span class="si">{}</span><span class="s2"> done once&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Incompatible tasks&quot;</span><span class="p">)</span>
        <span class="c1"># Incompatible tasks</span>
        <span class="n">IncompatibilityCounter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">BadPairing</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">IncompatibleTasks</span><span class="p">:</span>
            <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">BadTask</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">BadTask</span> <span class="ow">in</span> <span class="n">BadPairing</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">BadTask</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Incompatibility </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">IncompatibilityCounter</span>
            <span class="n">IncompatibilityCounter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Task Dependencies&quot;</span><span class="p">)</span>
        <span class="c1"># Task Dependencies</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="n">DepCounter</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">for</span> <span class="n">DepTasks</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">DepTasks</span><span class="p">:</span>
                                    <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span>
                                        <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">predecessor</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">DepTasks</span><span class="p">),</span> <span class="s2">&quot;Dependency </span><span class="si">{0}</span><span class="s2"> of task </span><span class="si">{1}</span><span class="s2"> for agent </span><span class="si">{2}</span><span class="s2"> at time </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DepCounter</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                    <span class="n">DepCounter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># The resource availability and information acquisition constraints</span>
            <span class="c1">#  are modified if communication is not packetized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability&quot;</span><span class="p">)</span>
            <span class="c1"># Resource availability</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="p">(</span><span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                                    <span class="o">+</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Resources </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: New information acquisition&quot;</span><span class="p">)</span>
            <span class="c1"># New information acquisition</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">InfoConstraint</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span>
                            <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">m</span><span class="p">])])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">InfoConstraint</span> <span class="o">-=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                                      <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">InfoConstraint</span><span class="p">,</span> <span class="s2">&quot;Information of task </span><span class="si">{0}</span><span class="s2"> at agent </span><span class="si">{1}</span><span class="s2">, time </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: Resource availability (no packet comms)&quot;</span><span class="p">)</span>
            <span class="c1"># Resource availability</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">ResourceAvailabilityConstraintLST</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span>
                                                         <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="c1"># If we started sending at MCT_to, we will be done just about now. So if we start at MCT_to+1, we&#39;re still going</span>
                            <span class="n">MCT_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_to</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">ResourceAvailabilityConstraintLST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MCT_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
                            <span class="n">MCT_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_from</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_from</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">ResourceAvailabilityConstraintLST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MCT_from</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
                    <span class="n">ResourceAvailabilityConstraint</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span>
                        <span class="n">ResourceAvailabilityConstraintLST</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span>
                    <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">ResourceAvailabilityConstraint</span><span class="p">,</span> <span class="s2">&quot;Resources </span><span class="si">{0}</span><span class="s2"> at </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: New information acquisition (no packet comms)&quot;</span><span class="p">)</span>
            <span class="c1"># New information acquisition</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">InfoConstraintLST</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="c1"># This is the maximum time so that we will have received the information by time t+1</span>
                            <span class="n">MCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">InfoConstraintLST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span>
                                    <span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MCT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">InfoConstraintLST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">InfoConstraint</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">(</span><span class="n">InfoConstraintLST</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                        <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="n">InfoConstraint</span><span class="p">,</span> <span class="s2">&quot;Information of task </span><span class="si">{0}</span><span class="s2"> at agent </span><span class="si">{1}</span><span class="s2">, time </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Knowledge&quot;</span><span class="p">)</span>
        <span class="c1"># Knowledge</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="n">MILPproblem</span> <span class="o">+=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                        <span class="p">),</span> <span class="s2">&quot;Knowledge of task </span><span class="si">{0}</span><span class="s2"> from ag</span><span class="si">{1}</span><span class="s2"> to ag</span><span class="si">{2}</span><span class="s2"> at t</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Communication Windows&quot;</span><span class="p">)</span>
        <span class="c1"># Communication Windows</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="n">CommWindowAvailable</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">upBound</span> <span class="o">=</span> <span class="n">CommWindowAvailable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Initial Information&quot;</span><span class="p">)</span>
        <span class="c1"># Initial Information</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upBound</span> <span class="o">=</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">InitialInformation</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetupTime</span> <span class="o">=</span> <span class="n">SetupEndTime</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Setup time: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupTime</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; s&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span> <span class="o">=</span> <span class="n">MILPproblem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICPULPScheduler.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICPULPScheduler.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Redirect output to prevent PuLP from dumping data all over stdout.</span>
            <span class="c1"># From https://stackoverflow.com/questions/8447185/</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Calling solver&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pulp</span><span class="o">.</span><span class="n">COIN</span><span class="p">()</span><span class="o">.</span><span class="n">available</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Using COIN&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pulp</span><span class="o">.</span><span class="n">COIN</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">pulp</span><span class="o">.</span><span class="n">GUROBI</span><span class="p">()</span><span class="o">.</span><span class="n">available</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Using GUROBI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pulp</span><span class="o">.</span><span class="n">GUROBI</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">pulp</span><span class="o">.</span><span class="n">CPLEX</span><span class="p">()</span><span class="o">.</span><span class="n">available</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Using CPLEX&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">pulp</span><span class="o">.</span><span class="n">CPLEX</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Using default solver&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Status: &quot;</span> <span class="o">+</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpStatus</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">status</span><span class="p">])</span>

        <span class="c1"># Unpack the output</span>
        <span class="n">TaskSchedule</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpStatus</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">status</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Infeasible&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This is a ugly hack. Sometimes the solver will return weird fractional solutions even if we require integral ones. Here, we round.</span>
            <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">varValue</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                            <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                            <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                            <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                    <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskSchedule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TaskSchedule</span>
        <span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;TaskAgent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TaskAgent</span>
        <span class="n">TaskAssignment</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">varValue</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">EndCommTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">EndCommTime</span><span class="p">])</span>

        <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">objective</span><span class="p">)</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">status</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpStatus</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">status</span><span class="p">]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Restore stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span></div>

<div class="viewcode-block" id="MOSAICPULPScheduler.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICPULPScheduler.getSolverState">[docs]</a>    <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpStatus</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span><span class="o">.</span><span class="n">status</span><span class="p">]</span></div>

<div class="viewcode-block" id="MOSAICPULPScheduler.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICPULPScheduler.getProblem">[docs]</a>    <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">MILPproblem</span></div></div>


<div class="viewcode-block" id="MOSAICGLPKScheduler"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler">[docs]</a><span class="k">class</span> <span class="nc">MOSAICGLPKScheduler</span><span class="p">(</span><span class="n">MOSAICMILPScheduler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An implementation of the MILP scheduler that uses the GLPK solver.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MOSAICGLPKScheduler.solverSpecificInit"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.solverSpecificInit">[docs]</a>    <span class="k">def</span> <span class="nf">solverSpecificInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">GLPKAvailable</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GLPK not available. This will not work&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Create the GLPK problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span> <span class="o">=</span> <span class="n">glpk</span><span class="o">.</span><span class="n">LPX</span><span class="p">()</span>
        <span class="c1">#self.cpx.kind = int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">maximize</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aborter</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># No aborter for now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="mf">1e75</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span></div>

<div class="viewcode-block" id="MOSAICGLPKScheduler.setUp"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">SetupStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># This used to be a part of a larger function.</span>
        <span class="c1"># By redefining these variables as local, we save a lot of typing</span>
        <span class="c1">#  and possible errors.</span>
        <span class="n">Thor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Thor</span>
        <span class="n">AgentCapabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentCapabilities</span>
        <span class="n">Tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tasks</span>
        <span class="n">CommWindowsBandwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span>
        <span class="n">Options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span>

        <span class="k">if</span> <span class="s2">&quot;CostFunction&quot;</span> <span class="ow">in</span> <span class="n">Options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;CostFunction&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CostFunction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                            <span class="s2">&quot;total_task_reward&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: default cost function used&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_time&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: minimum-makespan optimization is not supported at this time.&quot;</span><span class="p">)</span>

        <span class="n">TasksList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">AgentsList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">TasksList</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">info_weight</span> <span class="o">=</span> <span class="mf">0.001</span>

        <span class="c1"># We find things</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">X</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">X_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                        <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">X_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">Tasks</span><span class="o">.</span><span class="n">TaskReward</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                        <span class="n">X_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="o">-</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">EnergyCost</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">X_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;X[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
        <span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">ix</span>

        <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">D_UB</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">D_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                    <span class="n">D_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;D[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                    <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">D_UB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">InitialInformation</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">D_UB</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">d_vars_len</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">x_vars_len</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">C_cost_optional</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">C_cost_energy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">C_name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">ix</span>
                            <span class="n">C_cost_optional</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">info_weight</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp_energy_cost</span> <span class="o">=</span> <span class="mf">0.</span>
                                <span class="n">end_comm_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span>
                                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">end_comm_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">end_comm_time</span> <span class="o">=</span> <span class="n">Thor</span><span class="o">+</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">transmission_time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">end_comm_time</span><span class="p">):</span>
                                    <span class="n">temp_energy_cost</span> <span class="o">+=</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">CommEnergyCost</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

                            <span class="n">C_cost_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">temp_energy_cost</span><span class="p">)</span>
                            <span class="n">C_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C[</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
                            <span class="n">ix</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">-</span> <span class="n">d_vars_len</span> <span class="o">-</span> <span class="n">x_vars_len</span>

        <span class="n">X_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">X_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">C_cost</span> <span class="o">=</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;total_task_reward&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="n">C_cost_optional</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">CostFunction</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">C_cost_energy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># We create the variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">col_ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
            <span class="n">c</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="nb">bool</span>
            <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">X_name</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_cost</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D_name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col_ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D_name</span><span class="p">)):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)]</span>
                <span class="n">c</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="nb">bool</span>
                <span class="n">c</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">D_UB</span><span class="p">[</span><span class="n">col_ix</span><span class="p">])</span>
                <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">D_name</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">C_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C_name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col_ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C_name</span><span class="p">)):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">D_name</span><span class="p">)]</span>
                <span class="c1"># c.bounds = 0., 1.</span>
                <span class="n">c</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="nb">bool</span>
                <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">C_name</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="p">[</span><span class="n">col_ix</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">X_cost</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">D_name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">C_cost</span><span class="p">[</span><span class="n">col_ix</span><span class="p">]</span>

        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">OptionalTasks</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]]))]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Getting the job done once&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]]))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Incompatible tasks&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">BadPairing</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">IncompatibleTasks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">BadTask</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">BadTask</span> <span class="ow">in</span> <span class="n">BadPairing</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">BadTask</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">1.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Task Dependencies&quot;</span><span class="p">)</span>
        <span class="n">TaskDependencyConstraintList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">TaskDependencyConstraintList</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                            <span class="k">for</span> <span class="n">DepTasks</span> <span class="ow">in</span> <span class="n">Tasks</span><span class="o">.</span><span class="n">DependencyList</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">DepTasks</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[(</span>
                                        <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">predecessor</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">DepTasks</span><span class="p">]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.</span>

        <span class="k">if</span> <span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Resource availability&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="mi">1</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="mi">1</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: New information acquisition&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span>
                        <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">Tasks</span><span class="o">.</span><span class="n">ProductsSize</span><span class="p">[</span><span class="n">m</span><span class="p">])])</span>
                                      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                                 <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ComputeCumulativeCommBandwidth</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: Resource availability (no packet comms)&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                    <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationLoad</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="n">MCT_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_to</span> <span class="o">=</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_to</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                            <span class="n">MCT_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT_from</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">MCT_from</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tau</span><span class="p">]</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_from</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                <span class="n">MCT_from</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tau</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s2">&quot;Constraint: New information acquisition (no packet comms)&quot;</span><span class="p">)</span>
            <span class="c1"># New information acquisition</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">VarsList</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span>
                        <span class="n">CoeffList</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                            <span class="c1"># This is the maximum time so that we will have received the information by time t+1</span>
                            <span class="n">MCT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindMaxStartCommTime</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">MCT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">tt</span><span class="p">]</span>
                                             <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MCT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                                <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                                    <span class="n">MCT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">tt</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">VarsList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span> <span class="o">-</span>
                                                 <span class="n">AgentCapabilities</span><span class="o">.</span><span class="n">ComputationTime</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                            <span class="n">CoeffList</span> <span class="o">+=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">VarsList</span><span class="p">,</span> <span class="n">CoeffList</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Constraint: Knowledge&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matrix</span> <span class="o">=</span> <span class="p">[(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                                         <span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SetupStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Setup time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">=</span> <span class="n">x_vars_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span> <span class="o">=</span> <span class="n">d_vars_len</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm_vars_length</span> <span class="o">=</span> <span class="n">comm_vars_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span> <span class="o">=</span> <span class="n">TasksList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span> <span class="o">=</span> <span class="n">AgentsList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICGLPKScheduler.solve"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">SolveStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Verbose</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">glpk</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">term_on</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">LPisFeasible</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">start_lp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">cpx_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;presolve&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">!=</span> <span class="mf">1e75</span><span class="p">:</span>
            <span class="n">cpx_kwargs</span><span class="p">[</span><span class="s1">&#39;tm_lim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>  <span class="c1"># Convert to ms</span>
        <span class="c1"># We need this to build a feasible optimal basis. This is slow and annoying, and we will need a workaround.</span>
        <span class="c1"># Simplex does not respect the time limit</span>
        <span class="n">retval_lp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">simplex</span><span class="p">(</span><span class="o">**</span><span class="n">cpx_kwargs</span><span class="p">)</span>
        <span class="n">end_lp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_lp</span>
        <span class="k">if</span> <span class="n">retval_lp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;opt&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;feas&#39;</span><span class="p">):</span>
            <span class="c1"># Reminder to self: intopt does not take kwargs</span>
            <span class="n">start_ip</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">LPisFeasible</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span><span class="o">**</span><span class="n">cpx_kwargs</span><span class="p">)</span>
            <span class="n">end_ip</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ip</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s1">&#39;Solution status:                   </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">LPisFeasible</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;opt&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;feas&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span>
                <span class="s1">&#39;Optimal value:                     </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">))</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span><span class="o">.</span><span class="n">value_m</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">cols</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">SolveStartTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s1">&#39;Solve time: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span><span class="p">))</span>

        <span class="c1"># This is post-processing and should probably be moved to a different function so it can be called on an existing solution.</span>
        <span class="n">TaskSchedule</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">TaskAgent</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># This is a ugly hack. Sometimes the solver will return weird fractional solutions even if we require integral ones. Here, we round.</span>
        <span class="n">soleps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
            <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">soleps</span><span class="p">:</span>
                        <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                        <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                        <span class="n">FOUND_FLAG</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">FOUND_FLAG</span><span class="p">:</span>
                <span class="n">TaskSchedule</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">TaskAgent</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">TaskAssignment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TaskSchedule&#39;</span><span class="p">:</span> <span class="n">TaskSchedule</span><span class="p">,</span>
                          <span class="s1">&#39;TaskAgent&#39;</span><span class="p">:</span> <span class="n">TaskAgent</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span><span class="p">}</span>

        <span class="n">CommSchedule</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AgentsList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TasksList</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Thor</span><span class="p">):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CommWindowsBandwidth</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">][</span><span class="n">t</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Options</span><span class="p">[</span><span class="s1">&#39;Packet Comms&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">EndCommTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FindEndCommTime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
                                <span class="n">CommSchedule</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">EndCommTime</span><span class="p">])</span>

        <span class="n">RawOutput</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span><span class="p">]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vars_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_vars_len</span><span class="p">:]</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Fval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_val</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Exitstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Setup time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;Total time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetupEndTime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolveEndTime</span>
        <span class="n">RawOutput</span><span class="p">[</span><span class="s1">&#39;GLPK problem&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TaskAssignment</span> <span class="o">=</span> <span class="n">TaskAssignment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RawOutput</span> <span class="o">=</span> <span class="n">RawOutput</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CommSchedule</span> <span class="o">=</span> <span class="n">CommSchedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MOSAICGLPKScheduler.schedule"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.schedule">[docs]</a>    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Override to implement time limit</span>
        <span class="n">startSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSetUp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">endSetupTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSetupTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Setup time (s): </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSetupTime</span><span class="p">))</span>
        <span class="n">startSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="n">endSolveTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">startSolveTime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Solution time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbprint</span><span class="p">(</span><span class="s2">&quot;Overall time: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endSolveTime</span> <span class="o">+</span> <span class="n">endSetupTime</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsFeasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Problem infeasible!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatToJSON</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Timeline</span></div>

<div class="viewcode-block" id="MOSAICGLPKScheduler.getSolverState"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.getSolverState">[docs]</a>    <span class="k">def</span> <span class="nf">getSolverState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">problemIsSolved</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Solver not called&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">status</span></div>

<div class="viewcode-block" id="MOSAICGLPKScheduler.getProblem"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.getProblem">[docs]</a>    <span class="k">def</span> <span class="nf">getProblem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span></div>

    <span class="k">def</span> <span class="nf">writeSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;MIPstarts_GLPK&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">writelevel</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mps</span><span class="o">=</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_problem.mps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mip</span><span class="o">=</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.mps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sol</span><span class="o">=</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.sol&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="MOSAICGLPKScheduler.setTimeLimits"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.setTimeLimits">[docs]</a>    <span class="k">def</span> <span class="nf">setTimeLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DetTicksLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">,</span> <span class="n">ClockTimeLimit</span><span class="o">=</span><span class="mf">1e75</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">DetTicksLimit</span> <span class="o">!=</span> <span class="mf">1e75</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: deterministic ticks limit ignored by GLPK&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ClockTimeLimit</span> <span class="o">!=</span> <span class="mf">1e75</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: clock time limit partly nonfunctional in GLPK&quot;</span><span class="p">)</span>
            <span class="c1"># pyglpk does not implement calling intop</span>
            <span class="c1"># (it says it does but it calls .integer)</span>
            <span class="c1"># The &#39;integer&#39; solver requires a basis</span>
            <span class="c1"># To solve the basis we need a simplex solver</span>
            <span class="c1">#  which does not support a time limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="n">ClockTimeLimit</span></div>

<div class="viewcode-block" id="MOSAICGLPKScheduler.setSolverParameters"><a class="viewcode-back" href="../../../../class_documentation.html#mosaic_schedulers.schedulers.tv_milp.MOSAICSolver.MOSAICGLPKScheduler.setSolverParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setSolverParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Properties</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: parameters ignored by GLPK&quot;</span><span class="p">)</span></div></div>
        <span class="c1"># for param in Properties:</span>
        <span class="c1">#     propset = self.cpx.parameters</span>
        <span class="c1">#     for prop in param:</span>
        <span class="c1">#         propset = getattr(propset, prop)</span>
        <span class="c1">#     propset.set(Properties[param])</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, California Institute of Technology (&#34;Caltech&#34;)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>